(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
const random_1 = require("./utils/random");
const range_1 = require("./utils/range");
const SPHERE_COUNT = 400;
const AREA = [800, 450];
const radii = new Float32Array(SPHERE_COUNT);
const positions = new Float32Array(2 * SPHERE_COUNT);
const velocities = new Float32Array(2 * SPHERE_COUNT);
const settings = {
    K: 0.1,
    color: [.2, .4, .8]
};
for (var i = 0; i < SPHERE_COUNT; i++) {
    radii[i] = random_1.randInt(4, 30);
    positions[i * 2] = random_1.randInt(0, AREA[0]);
    positions[i * 2 + 1] = random_1.randInt(0, AREA[1]);
    velocities[i * 2] = random_1.randInt(-4, 4);
    velocities[i * 2 + 1] = random_1.randInt(-4, 4);
}
console.log(positions.length);
const vsrc = `
precision mediump float;

attribute vec2 a_vertices;

void main () {
  gl_Position = vec4(a_vertices, 1.0, 1.0);
}
`;
const fsrc = `
precision mediump float;

uniform vec2 u_resolution;
uniform float u_time;
uniform float u_K;
uniform vec3 u_color;
uniform float u_radii [ ${SPHERE_COUNT} ];
uniform vec2 u_positions [ ${SPHERE_COUNT} ];

float sdf_sphere ( float r, vec2 c, vec2 p ) {
  return distance(p, c) - r;
}

void main () {
  vec2 p = gl_FragCoord.xy;
  float dist = 0.;

  for ( int i = 0; i < ${SPHERE_COUNT}; i++ ) {
    dist += exp(-u_K * sdf_sphere(u_radii[i], u_positions[i], p));
  }
  dist = -log(dist) / u_K;
  float opacity = clamp(.5 - dist, 0.0, 1.0);

  gl_FragColor = vec4(u_color, opacity);
}
`;
const canvas = document.createElement('canvas');
const slider = document.createElement('input');
const gl = canvas.getContext('webgl');
if (gl == null) {
    throw new Error('gl context could not be obtained');
}
const vertex = gl.createShader(gl.VERTEX_SHADER);
const fragment = gl.createShader(gl.FRAGMENT_SHADER);
const program = gl.createProgram();
const screenQuad = new Float32Array([
    -1, 1, -1, -1, 1, -1,
    -1, 1, 1, -1, 1, 1
]);
const quadSize = screenQuad.length / 2;
if (vertex == null && fragment == null && program == null) {
    throw new Error('gl resources could not be obtained');
}
gl.shaderSource(vertex, vsrc);
gl.compileShader(vertex);
gl.shaderSource(fragment, fsrc);
gl.compileShader(fragment);
gl.attachShader(program, vertex);
gl.attachShader(program, fragment);
gl.linkProgram(program);
gl.useProgram(program);
if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
    console.log(gl.getShaderInfoLog(vertex));
    console.log(gl.getShaderInfoLog(fragment));
    console.log(gl.getProgramInfoLog(program));
}
const verticesBuffer = gl.createBuffer();
const a_locations = {
    a_vertices: gl.getAttribLocation(program, 'a_vertices')
};
const u_locations = {
    u_K: gl.getUniformLocation(program, 'u_K'),
    u_color: gl.getUniformLocation(program, 'u_color'),
    u_time: gl.getUniformLocation(program, 'u_time'),
    u_resolution: gl.getUniformLocation(program, 'u_resolution'),
    u_radii: gl.getUniformLocation(program, 'u_radii'),
    u_positions: gl.getUniformLocation(program, 'u_positions')
};
gl.bindBuffer(gl.ARRAY_BUFFER, verticesBuffer);
gl.enableVertexAttribArray(a_locations.a_vertices);
gl.vertexAttribPointer(a_locations.a_vertices, 2, gl.FLOAT, false, 0, 0);
gl.bufferData(gl.ARRAY_BUFFER, screenQuad, gl.STATIC_DRAW);
canvas.width = AREA[0];
canvas.height = AREA[1];
Object.assign(slider, {
    type: 'range',
    min: 0,
    max: 0.1,
    step: 0.01,
    value: settings.K
});
slider.addEventListener('input', _ => settings.K = Number(slider.value));
Object.assign(canvas.style, {
    boxSizing: 'border-box',
    border: '2px solid Coral'
});
Object.assign(document.body.style, {
    margin: '0',
    backgroundColor: 'MistyRose'
});
document.body.appendChild(canvas);
document.body.appendChild(slider);
gl.viewport(0, 0, AREA[0], AREA[1]);
gl.enable(gl.CULL_FACE);
gl.clearColor(0, 0, 0, 0);
gl.useProgram(program);
requestAnimationFrame(function render() {
    const t = performance.now();
    const buffer = 1.05;
    if (t > 1000) {
        for (var i = 0; i < 2 * SPHERE_COUNT; i += 2) {
            positions[i] = range_1.wrap(-AREA[0] * buffer, AREA[0] * buffer, positions[i] + velocities[i]);
            positions[i + 1] = range_1.wrap(-AREA[1] * buffer, AREA[1] * buffer, positions[i + 1] + velocities[i + 1]);
        }
    }
    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
    gl.uniform1f(u_locations.u_time, performance.now());
    gl.uniform2f(u_locations.u_resolution, AREA[0], AREA[1]);
    gl.uniform1f(u_locations.u_K, settings.K);
    gl.uniform3f(u_locations.u_color, settings.color[0], settings.color[1], settings.color[2]);
    gl.uniform1fv(u_locations.u_radii, radii);
    gl.uniform2fv(u_locations.u_positions, positions);
    gl.drawArrays(gl.TRIANGLES, 0, quadSize);
    requestAnimationFrame(render);
});

},{"./utils/random":2,"./utils/range":3}],2:[function(require,module,exports){
"use strict";
function randInt(min, max) {
    return Math.floor(Math.random() * (max - min) + min);
}
exports.randInt = randInt;

},{}],3:[function(require,module,exports){
"use strict";
function wrap(min, max, val) {
    if (val > max)
        return min + (val - max);
    else if (val < min)
        return max + (min - val);
    else
        return val;
}
exports.wrap = wrap;

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL3dhdGNoaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbWFpbi50cyIsInNyYy91dGlscy9yYW5kb20udHMiLCJzcmMvdXRpbHMvcmFuZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FDQUEsMkNBQXdDO0FBQ3hDLHlDQUFvQztBQUVwQyxNQUFNLFlBQVksR0FBRyxHQUFHLENBQUE7QUFDeEIsTUFBTSxJQUFJLEdBQUcsQ0FBRSxHQUFHLEVBQUUsR0FBRyxDQUFFLENBQUE7QUFFekIsTUFBTSxLQUFLLEdBQUcsSUFBSSxZQUFZLENBQUMsWUFBWSxDQUFDLENBQUE7QUFDNUMsTUFBTSxTQUFTLEdBQUcsSUFBSSxZQUFZLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxDQUFBO0FBQ3BELE1BQU0sVUFBVSxHQUFHLElBQUksWUFBWSxDQUFDLENBQUMsR0FBRyxZQUFZLENBQUMsQ0FBQTtBQUNyRCxNQUFNLFFBQVEsR0FBRztJQUNmLENBQUMsRUFBRSxHQUFHO0lBQ04sS0FBSyxFQUFFLENBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUU7Q0FDdEIsQ0FBQTtBQUVELEdBQUcsQ0FBQyxDQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsWUFBWSxFQUFFLENBQUMsRUFBRSxFQUFHLENBQUM7SUFDeEMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLGdCQUFPLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFBO0lBQ3pCLFNBQVMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsZ0JBQU8sQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDdEMsU0FBUyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsZ0JBQU8sQ0FBQyxDQUFDLEVBQUUsSUFB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QztRQUFDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBRSxHQUFHLEdBQUcsR0FBRyxDQUFFLENBQUE7SUFDaEQsSUFBSTtRQUFrQixNQUFNLENBQUMsR0FBRyxDQUFBO0FBQ2xDLENBQUM7QUFKRCxvQkFJQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJpbXBvcnQgeyByYW5kSW50IH0gZnJvbSAnLi91dGlscy9yYW5kb20nXG5pbXBvcnQgeyB3cmFwIH0gZnJvbSAnLi91dGlscy9yYW5nZSdcblxuY29uc3QgU1BIRVJFX0NPVU5UID0gNDAwXG5jb25zdCBBUkVBID0gWyA4MDAsIDQ1MCBdXG5cbmNvbnN0IHJhZGlpID0gbmV3IEZsb2F0MzJBcnJheShTUEhFUkVfQ09VTlQpXG5jb25zdCBwb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkFycmF5KDIgKiBTUEhFUkVfQ09VTlQpXG5jb25zdCB2ZWxvY2l0aWVzID0gbmV3IEZsb2F0MzJBcnJheSgyICogU1BIRVJFX0NPVU5UKVxuY29uc3Qgc2V0dGluZ3MgPSB7XG4gIEs6IDAuMSxcbiAgY29sb3I6IFsgLjIsIC40LCAuOCBdXG59XG5cbmZvciAoIHZhciBpID0gMDsgaSA8IFNQSEVSRV9DT1VOVDsgaSsrICkge1xuICByYWRpaVtpXSA9IHJhbmRJbnQoNCwgMzApXG4gIHBvc2l0aW9uc1tpICogMl0gPSByYW5kSW50KDAsIEFSRUFbMF0pXG4gIHBvc2l0aW9uc1tpICogMiArIDFdID0gcmFuZEludCgwLCBBUkVBWzFdKVxuICB2ZWxvY2l0aWVzW2kgKiAyXSA9IHJhbmRJbnQoLTQsIDQpXG4gIHZlbG9jaXRpZXNbaSAqIDIgKyAxXSA9IHJhbmRJbnQoLTQsIDQpXG59XG5cbmNvbnNvbGUubG9nKHBvc2l0aW9ucy5sZW5ndGgpXG5cbmNvbnN0IHZzcmMgPSBcbmBcbnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0O1xuXG5hdHRyaWJ1dGUgdmVjMiBhX3ZlcnRpY2VzO1xuXG52b2lkIG1haW4gKCkge1xuICBnbF9Qb3NpdGlvbiA9IHZlYzQoYV92ZXJ0aWNlcywgMS4wLCAxLjApO1xufVxuYFxuXG5jb25zdCBmc3JjID1cbmBcbnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0O1xuXG51bmlmb3JtIHZlYzIgdV9yZXNvbHV0aW9uO1xudW5pZm9ybSBmbG9hdCB1X3RpbWU7XG51bmlmb3JtIGZsb2F0IHVfSztcbnVuaWZvcm0gdmVjMyB1X2NvbG9yO1xudW5pZm9ybSBmbG9hdCB1X3JhZGlpIFsgJHsgU1BIRVJFX0NPVU5UIH0gXTtcbnVuaWZvcm0gdmVjMiB1X3Bvc2l0aW9ucyBbICR7IFNQSEVSRV9DT1VOVCB9IF07XG5cbmZsb2F0IHNkZl9zcGhlcmUgKCBmbG9hdCByLCB2ZWMyIGMsIHZlYzIgcCApIHtcbiAgcmV0dXJuIGRpc3RhbmNlKHAsIGMpIC0gcjtcbn1cblxudm9pZCBtYWluICgpIHtcbiAgdmVjMiBwID0gZ2xfRnJhZ0Nvb3JkLnh5O1xuICBmbG9hdCBkaXN0ID0gMC47XG5cbiAgZm9yICggaW50IGkgPSAwOyBpIDwgJHsgU1BIRVJFX0NPVU5UIH07IGkrKyApIHtcbiAgICBkaXN0ICs9IGV4cCgtdV9LICogc2RmX3NwaGVyZSh1X3JhZGlpW2ldLCB1X3Bvc2l0aW9uc1tpXSwgcCkpO1xuICB9XG4gIGRpc3QgPSAtbG9nKGRpc3QpIC8gdV9LO1xuICBmbG9hdCBvcGFjaXR5ID0gY2xhbXAoLjUgLSBkaXN0LCAwLjAsIDEuMCk7XG5cbiAgZ2xfRnJhZ0NvbG9yID0gdmVjNCh1X2NvbG9yLCBvcGFjaXR5KTtcbn1cbmBcblxuY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJylcbmNvbnN0IHNsaWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0JylcbmNvbnN0IGdsID0gY2FudmFzLmdldENvbnRleHQoJ3dlYmdsJylcblxuaWYgKCBnbCA9PSBudWxsICkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ2dsIGNvbnRleHQgY291bGQgbm90IGJlIG9idGFpbmVkJylcbn1cblxuY29uc3QgdmVydGV4ID0gZ2wuY3JlYXRlU2hhZGVyKGdsLlZFUlRFWF9TSEFERVIpXG5jb25zdCBmcmFnbWVudCA9IGdsLmNyZWF0ZVNoYWRlcihnbC5GUkFHTUVOVF9TSEFERVIpXG5jb25zdCBwcm9ncmFtID0gZ2wuY3JlYXRlUHJvZ3JhbSgpXG5jb25zdCBzY3JlZW5RdWFkID0gbmV3IEZsb2F0MzJBcnJheShbXG4gIC0xLCAxLCAtMSwgLTEsIDEsIC0xLFxuICAtMSwgMSwgMSwgLTEsIDEsIDFcbl0pIFxuY29uc3QgcXVhZFNpemUgPSBzY3JlZW5RdWFkLmxlbmd0aCAvIDIgXG5cbmlmICggdmVydGV4ID09IG51bGwgJiYgZnJhZ21lbnQgPT0gbnVsbCAmJiBwcm9ncmFtID09IG51bGwgKSB7XG4gIHRocm93IG5ldyBFcnJvcignZ2wgcmVzb3VyY2VzIGNvdWxkIG5vdCBiZSBvYnRhaW5lZCcpXG59XG5cbmdsLnNoYWRlclNvdXJjZSh2ZXJ0ZXgsIHZzcmMpXG5nbC5jb21waWxlU2hhZGVyKHZlcnRleClcbmdsLnNoYWRlclNvdXJjZShmcmFnbWVudCwgZnNyYylcbmdsLmNvbXBpbGVTaGFkZXIoZnJhZ21lbnQpXG5cbmdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCB2ZXJ0ZXgpXG5nbC5hdHRhY2hTaGFkZXIocHJvZ3JhbSwgZnJhZ21lbnQpXG5nbC5saW5rUHJvZ3JhbShwcm9ncmFtKVxuZ2wudXNlUHJvZ3JhbShwcm9ncmFtKVxuXG5pZiAoICFnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKHByb2dyYW0sIGdsLkxJTktfU1RBVFVTKSApIHtcbiAgY29uc29sZS5sb2coZ2wuZ2V0U2hhZGVySW5mb0xvZyh2ZXJ0ZXgpKVxuICBjb25zb2xlLmxvZyhnbC5nZXRTaGFkZXJJbmZvTG9nKGZyYWdtZW50KSlcbiAgY29uc29sZS5sb2coZ2wuZ2V0UHJvZ3JhbUluZm9Mb2cocHJvZ3JhbSkpXG59XG5cbmNvbnN0IHZlcnRpY2VzQnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKClcbmNvbnN0IGFfbG9jYXRpb25zID0ge1xuICBhX3ZlcnRpY2VzOiBnbC5nZXRBdHRyaWJMb2NhdGlvbihwcm9ncmFtLCAnYV92ZXJ0aWNlcycpXG59XG5jb25zdCB1X2xvY2F0aW9ucyA9IHtcbiAgdV9LOiBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgJ3VfSycpIGFzIFdlYkdMVW5pZm9ybUxvY2F0aW9uLFxuICB1X2NvbG9yOiBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgJ3VfY29sb3InKSBhcyBXZWJHTFVuaWZvcm1Mb2NhdGlvbixcbiAgdV90aW1lOiBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgJ3VfdGltZScpIGFzIFdlYkdMVW5pZm9ybUxvY2F0aW9uLFxuICB1X3Jlc29sdXRpb246IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCAndV9yZXNvbHV0aW9uJykgYXMgV2ViR0xVbmlmb3JtTG9jYXRpb24sXG4gIHVfcmFkaWk6IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCAndV9yYWRpaScpIGFzIFdlYkdMVW5pZm9ybUxvY2F0aW9uLFxuICB1X3Bvc2l0aW9uczogZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sICd1X3Bvc2l0aW9ucycpIGFzIFdlYkdMVW5pZm9ybUxvY2F0aW9uXG59XG5cbmdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB2ZXJ0aWNlc0J1ZmZlcilcbmdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KGFfbG9jYXRpb25zLmFfdmVydGljZXMpXG5nbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKGFfbG9jYXRpb25zLmFfdmVydGljZXMsIDIsIGdsLkZMT0FULCBmYWxzZSwgMCwgMClcbmdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBzY3JlZW5RdWFkLCBnbC5TVEFUSUNfRFJBVylcblxuY2FudmFzLndpZHRoID0gQVJFQVswXVxuY2FudmFzLmhlaWdodCA9IEFSRUFbMV1cbk9iamVjdC5hc3NpZ24oc2xpZGVyLCB7XG4gIHR5cGU6ICdyYW5nZScsXG4gIG1pbjogMCxcbiAgbWF4OiAwLjEsXG4gIHN0ZXA6IDAuMDEsXG4gIHZhbHVlOiBzZXR0aW5ncy5LXG59KVxuc2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgXyA9PiBzZXR0aW5ncy5LID0gTnVtYmVyKHNsaWRlci52YWx1ZSkpXG5PYmplY3QuYXNzaWduKGNhbnZhcy5zdHlsZSwge1xuICBib3hTaXppbmc6ICdib3JkZXItYm94JyxcbiAgYm9yZGVyOiAnMnB4IHNvbGlkIENvcmFsJ1xufSlcbk9iamVjdC5hc3NpZ24oZG9jdW1lbnQuYm9keS5zdHlsZSwge1xuICBtYXJnaW46ICcwJyxcbiAgYmFja2dyb3VuZENvbG9yOiAnTWlzdHlSb3NlJ1xufSlcbmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKVxuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzbGlkZXIpXG5cbmdsLnZpZXdwb3J0KDAsIDAsIEFSRUFbMF0sIEFSRUFbMV0pXG5nbC5lbmFibGUoZ2wuQ1VMTF9GQUNFKVxuZ2wuY2xlYXJDb2xvcigwLCAwLCAwLCAwKVxuZ2wudXNlUHJvZ3JhbShwcm9ncmFtKVxuXG5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gcmVuZGVyKCkge1xuICBjb25zdCB0ID0gcGVyZm9ybWFuY2Uubm93KClcbiAgY29uc3QgYnVmZmVyID0gMS4wNVxuXG4gIGlmICggdCA+IDEwMDAgKSB7XG4gICAgZm9yICggdmFyIGkgPSAwOyBpIDwgMiAqIFNQSEVSRV9DT1VOVDsgaSArPSAyICkge1xuICAgICAgcG9zaXRpb25zW2ldID0gd3JhcCgtQVJFQVswXSAqIGJ1ZmZlciwgQVJFQVswXSAqIGJ1ZmZlciwgcG9zaXRpb25zW2ldICsgdmVsb2NpdGllc1tpXSlcbiAgICAgIHBvc2l0aW9uc1tpICsgMV0gPSB3cmFwKC1BUkVBWzFdICogYnVmZmVyLCBBUkVBWzFdICogYnVmZmVyLCBwb3NpdGlvbnNbaSArIDFdKyB2ZWxvY2l0aWVzW2kgKyAxXSlcbiAgICB9XG4gIH1cbiAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCB8IGdsLkRFUFRIX0JVRkZFUl9CSVQpXG4gIGdsLnVuaWZvcm0xZih1X2xvY2F0aW9ucy51X3RpbWUsIHBlcmZvcm1hbmNlLm5vdygpKVxuICBnbC51bmlmb3JtMmYodV9sb2NhdGlvbnMudV9yZXNvbHV0aW9uLCBBUkVBWzBdLCBBUkVBWzFdKVxuICBnbC51bmlmb3JtMWYodV9sb2NhdGlvbnMudV9LLCBzZXR0aW5ncy5LKVxuICBnbC51bmlmb3JtM2YodV9sb2NhdGlvbnMudV9jb2xvciwgc2V0dGluZ3MuY29sb3JbMF0sIHNldHRpbmdzLmNvbG9yWzFdLCBzZXR0aW5ncy5jb2xvclsyXSlcbiAgZ2wudW5pZm9ybTFmdih1X2xvY2F0aW9ucy51X3JhZGlpLCByYWRpaSlcbiAgZ2wudW5pZm9ybTJmdih1X2xvY2F0aW9ucy51X3Bvc2l0aW9ucywgcG9zaXRpb25zKVxuICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFUywgMCwgcXVhZFNpemUpXG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpXG59KVxuIiwiZXhwb3J0IGZ1bmN0aW9uIHJhbmRJbnQgKCBtaW46IG51bWJlciwgbWF4OiBudW1iZXIgKTogbnVtYmVyIHtcbiAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICggbWF4IC0gbWluICkgKyBtaW4pXG59XG4iLCJleHBvcnQgZnVuY3Rpb24gd3JhcCAoIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlciwgdmFsOiBudW1iZXIgKTogbnVtYmVyIHtcbiAgaWYgICAgICAoIHZhbCA+IG1heCApIHJldHVybiBtaW4gKyAoIHZhbCAtIG1heCApXG4gIGVsc2UgaWYgKCB2YWwgPCBtaW4gKSByZXR1cm4gbWF4ICsgKCBtaW4gLSB2YWwgKVxuICBlbHNlICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbFxufVxuIl19
