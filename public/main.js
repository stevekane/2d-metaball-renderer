(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/// <reference path="../typings/index.d.ts" />
"use strict";
var random_1 = require("./utils/random");
var canvas = document.createElement('canvas');
var gl = canvas.getContext('webgl');
if (gl == null) {
    throw new Error('gl context could not be obtained');
}
if (gl.getExtension('OES_texture_float') == null) {
    throw new Error('FLOAT Texture extension not available');
}
var settings = {
    K: 0.2,
    G: 2000,
    R: .02,
    cellSize: 3,
    color: [.2, .4, .8],
};
var COUNT = 1024;
var positions = new Float32Array(COUNT * 4);
var velocities = new Float32Array(COUNT * 4);
var AREA_X = 400;
var AREA_Y = 400;
var BUCKET_X = 32;
var BUCKET_Y = 32;
var BUCKET_COUNT = BUCKET_X * BUCKET_Y;
var MAX_PARTICLES_PER_BUCKET = 256;
var activeIndices = new Int32Array(BUCKET_COUNT);
var pSorted = new Float32Array(BUCKET_COUNT * MAX_PARTICLES_PER_BUCKET * 4);
var vsrc = "\nprecision mediump float;\n\nattribute vec2 a_vertices;\n\nvoid main () {\n  gl_Position = vec4(a_vertices, 1.0, 1.0);\n}\n";
var fsrc = "\nprecision mediump float;\n\nuniform float u_time;\nuniform float u_K;\nuniform float u_R;\nuniform vec3 u_color;\nuniform float u_bucket;\nuniform sampler2D u_positions;\n\nconst float DX = 1. / " + MAX_PARTICLES_PER_BUCKET + ".;\nconst float DY = 1. / " + BUCKET_COUNT + ".;\nconst float BUCKET_X = " + BUCKET_X + ".;\nconst float BUCKET_Y = " + BUCKET_Y + ".;\nconst float AREA_X = " + AREA_X + ".;\nconst float AREA_Y = " + AREA_Y + ".;\n\nfloat sdf_sphere ( float r, vec2 c, vec2 p ) {\n  return distance(p, c) - r;\n}\n\nfloat to_bucket_index ( vec2 p ) {\n  return floor(max(0., p.x / (AREA_X / BUCKET_X))) +\n         floor(max(0., p.y / (AREA_Y / BUCKET_Y))) * BUCKET_Y;\n}\n\nvoid main () {\n  vec2 p = gl_FragCoord.xy;\n  vec2 pos;\n  vec2 tex_coord;\n  vec4 particle;\n  float bucket_index = to_bucket_index(p);\n  float weight = 0.;\n  float dist = 0.;\n\n  for ( float i = 0.; i < 1.; i += DX ) {\n    tex_coord.x = i;\n    tex_coord.y = bucket_index * DY;\n    particle = texture2D(u_positions, tex_coord);\n    pos = particle.xy;\n    weight = particle.w;\n    dist += weight * exp(-u_K * sdf_sphere(u_R, pos, p));\n  }\n  dist = log(dist) / u_K;\n  float opacity = step(0., dist);\n  gl_FragColor = vec4(u_color, opacity);\n}\n";
var vertex = gl.createShader(gl.VERTEX_SHADER);
var fragment = gl.createShader(gl.FRAGMENT_SHADER);
var program = gl.createProgram();
var screenQuad = new Float32Array([
    -1, 1, -1, -1, 1, -1,
    -1, 1, 1, -1, 1, 1
]);
var quadSize = screenQuad.length / 2;
if (vertex == null && fragment == null && program == null) {
    throw new Error('gl resources could not be obtained');
}
gl.shaderSource(vertex, vsrc);
gl.compileShader(vertex);
gl.shaderSource(fragment, fsrc);
gl.compileShader(fragment);
gl.attachShader(program, vertex);
gl.attachShader(program, fragment);
gl.linkProgram(program);
gl.useProgram(program);
if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
    console.log(gl.getShaderInfoLog(vertex));
    console.log(gl.getShaderInfoLog(fragment));
    console.log(gl.getProgramInfoLog(program));
}
var verticesBuffer = gl.createBuffer();
var a_locations = {
    a_vertices: gl.getAttribLocation(program, 'a_vertices')
};
var u_locations = {
    u_K: gl.getUniformLocation(program, 'u_K'),
    u_R: gl.getUniformLocation(program, 'u_R'),
    u_color: gl.getUniformLocation(program, 'u_color'),
    u_time: gl.getUniformLocation(program, 'u_time'),
    u_positions: gl.getUniformLocation(program, 'u_positions'),
    u_bucket: gl.getUniformLocation(program, 'u_bucket')
};
var ps = gl.createTexture();
gl.bindBuffer(gl.ARRAY_BUFFER, verticesBuffer);
gl.enableVertexAttribArray(a_locations.a_vertices);
gl.vertexAttribPointer(a_locations.a_vertices, 2, gl.FLOAT, false, 0, 0);
gl.bufferData(gl.ARRAY_BUFFER, screenQuad, gl.STATIC_DRAW);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, ps);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, MAX_PARTICLES_PER_BUCKET, BUCKET_COUNT, 0, gl.RGBA, gl.FLOAT, pSorted);
canvas.width = AREA_X;
canvas.height = AREA_Y;
canvas.style.boxSizing = 'border-box';
canvas.style.border = '2px solid Coral';
document.body.style.margin = '0';
document.body.style.backgroundColor = 'MistyRose';
document.body.appendChild(canvas);
gl.viewport(0, 0, AREA_X, AREA_Y);
gl.enable(gl.CULL_FACE);
gl.disable(gl.DEPTH_TEST);
gl.clearColor(0, 0, 0, 0);
gl.useProgram(program);
var raf = window.requestAnimationFrame;
var clock = { then: Date.now(), now: Date.now() };
for (var i = 0; i < positions.length; i += 4) {
    positions[i] = random_1.randNum(0, AREA_X);
    positions[i + 1] = random_1.randNum(0, AREA_Y);
}
function getBucketIndex(x, y) {
    if (x < 0 || y > AREA_X)
        return -1;
    else if (y < 0 || y > AREA_Y)
        return -1;
    else
        return Math.floor(Math.max(0, x / (AREA_X / BUCKET_X))) +
            Math.floor(Math.max(0, y / (AREA_Y / BUCKET_Y))) * BUCKET_Y;
}
raf(function render() {
    clock.then = clock.now;
    clock.now = Date.now();
    activeIndices.fill(0);
    pSorted.fill(0);
    for (var i = 0, G = -settings.G, dT = 0.01; i < positions.length; i += 4) {
        if (positions[i + 1] < Math.random() * -100) {
            velocities[i] = random_1.randNum(-200, 200);
            velocities[i + 1] = random_1.randNum(800, 1200);
            positions[i] = AREA_X / 2;
            positions[i + 1] = 0;
        }
        else {
            velocities[i + 1] += dT * G;
            positions[i] += dT * velocities[i];
            positions[i + 1] += dT * velocities[i + 1];
        }
        var px = positions[i];
        var py = positions[i + 1];
        var bIndex = getBucketIndex(px, py);
        if (bIndex == -1)
            continue;
        for (var k = -settings.cellSize; k <= settings.cellSize; k++) {
            for (var l = -settings.cellSize; l <= settings.cellSize; l++) {
                var index = bIndex - l - k * BUCKET_X;
                var aIndex = activeIndices[index];
                if (aIndex == null)
                    continue;
                var bStart = index * MAX_PARTICLES_PER_BUCKET * 4;
                var aOffset = aIndex * 4;
                var sIndex = bStart + aOffset;
                pSorted[sIndex] = px;
                pSorted[sIndex + 1] = py;
                pSorted[sIndex + 3] = 1;
                activeIndices[index] = Math.min(aIndex + 1, MAX_PARTICLES_PER_BUCKET - 1);
            }
        }
    }
    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
    gl.uniform1f(u_locations.u_time, clock.now);
    gl.uniform1f(u_locations.u_K, settings.K);
    gl.uniform1f(u_locations.u_R, settings.R);
    gl.uniform3f(u_locations.u_color, settings.color[0], settings.color[1], settings.color[2]);
    gl.uniform1i(u_locations.u_positions, 0);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, MAX_PARTICLES_PER_BUCKET, BUCKET_COUNT, 0, gl.RGBA, gl.FLOAT, pSorted);
    gl.drawArrays(gl.TRIANGLES, 0, quadSize);
    raf(render);
});

},{"./utils/random":2}],2:[function(require,module,exports){
"use strict";
function randInt(min, max) {
    return Math.floor(Math.random() * (max - min) + min);
}
exports.randInt = randInt;
function randNum(min, max) {
    return Math.random() * (max - min) + min;
}
exports.randNum = randNum;

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Vzci9saWIvbm9kZV9tb2R1bGVzL3dhdGNoaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbWFpbi50cyIsInNyYy91dGlscy9yYW5kb20udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQSw4Q0FBOEM7O0FBRTlDLHlDQUFpRDtBQUdqRCxJQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0FBQy9DLElBQU0sRUFBRSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUE7QUFFckMsRUFBRSxDQUFDLENBQUUsRUFBRSxJQUFJLElBQUssQ0FBQyxDQUFDLENBQUM7SUFDakIsTUFBTSxJQUFJLEtBQUssQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFBO0FBQ3JELENBQUM7QUFFRCxFQUFFLENBQUMsQ0FBRSxFQUFFLENBQUMsWUFBWSxDQUFDLG1CQUFtQixDQUFDLElBQUksSUFBSyxDQUFDLENBQUMsQ0FBQztJQUNuRCxNQUFNLElBQUksS0FBSyxDQUFDLHVDQUF1QyxDQUFDLENBQUE7QUFDMUQsQ0FBQztBQUVELElBQU0sUUFBUSxHQUFHO0lBQ2YsQ0FBQyxFQUFFLEdBQUc7SUFDTixDQUFDLEVBQUUsSUFBSTtJQUNQLENBQUMsRUFBRSxHQUFHO0lBQ04sUUFBUSxFQUFFLENBQUM7SUFDWCxLQUFLLEVBQUUsQ0FBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBRTtDQUN0QixDQUFBO0FBQ0QsSUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFBO0FBQ2xCLElBQU0sU0FBUyxHQUFHLElBQUksWUFBWSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQTtBQUM3QyxJQUFNLFVBQVUsR0FBRyxJQUFJLFlBQVksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUE7QUFDOUMsSUFBTSxNQUFNLEdBQUcsR0FBRyxDQUFBO0FBQ2xCLElBQU0s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RUFBRSxFQUFFLENBQUMsSUFBSSxFQUFFLHdCQUF3QixFQUFFLFlBQVksRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFBO0lBQy9HLEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFDeEMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0FBQ2IsQ0FBQyxDQUFDLENBQUE7Ozs7QUMxT0YsaUJBQTBCLEdBQVcsRUFBRSxHQUFXO0lBQ2hELE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFFLEdBQUcsR0FBRyxHQUFHLENBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQTtBQUN4RCxDQUFDO0FBRkQsMEJBRUM7QUFFRCxpQkFBMEIsR0FBVyxFQUFFLEdBQVc7SUFDaEQsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFFLEdBQUcsR0FBRyxHQUFHLENBQUUsR0FBRyxHQUFHLENBQUE7QUFDNUMsQ0FBQztBQUZELDBCQUVDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBpbmdzL2luZGV4LmQudHNcIiAvPlxuXG5pbXBvcnQgeyByYW5kSW50LCByYW5kTnVtIH0gZnJvbSAnLi91dGlscy9yYW5kb20nXG5pbXBvcnQgeyB3cmFwIH0gZnJvbSAnLi91dGlscy9yYW5nZSdcblxuY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJylcbmNvbnN0IGdsID0gY2FudmFzLmdldENvbnRleHQoJ3dlYmdsJylcblxuaWYgKCBnbCA9PSBudWxsICkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ2dsIGNvbnRleHQgY291bGQgbm90IGJlIG9idGFpbmVkJylcbn1cblxuaWYgKCBnbC5nZXRFeHRlbnNpb24oJ09FU190ZXh0dXJlX2Zsb2F0JykgPT0gbnVsbCApIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdGTE9BVCBUZXh0dXJlIGV4dGVuc2lvbiBub3QgYXZhaWxhYmxlJykgXG59XG5cbmNvbnN0IHNldHRpbmdzID0ge1xuICBLOiAwLjIsXG4gIEc6IDIwMDAsIFxuICBSOiAuMDIsXG4gIGNlbGxTaXplOiAzLFxuICBjb2xvcjogWyAuMiwgLjQsIC44IF0sXG59XG5jb25zdCBDT1VOVCA9IDEwMjRcbmNvbnN0IHBvc2l0aW9ucyA9IG5ldyBGbG9hdDMyQXJyYXkoQ09VTlQgKiA0KVxuY29uc3QgdmVsb2NpdGllcyA9IG5ldyBGbG9hdDMyQXJyYXkoQ09VTlQgKiA0KVxuY29uc3QgQVJFQV9YID0gNDAwXG5jb25zdCBBUkVBX1kgPSA0MDBcbmNvbnN0IEJVQ0tFVF9YID0gMzJcbmNvbnN0IEJVQ0tFVF9ZID0gMzJcbmNvbnN0IEJVQ0tFVF9DT1VOVCA9IEJVQ0tFVF9YICogQlVDS0VUX1lcbmNvbnN0IE1BWF9QQVJUSUNMRVNfUEVSX0JVQ0tFVCA9IDI1NlxuY29uc3QgYWN0aXZlSW5kaWNlcyA9IG5ldyBJbnQzMkFycmF5KEJVQ0tFVF9DT1VOVClcbmNvbnN0IHBTb3J0ZWQgPSBuZXcgRmxvYXQzMkFycmF5KEJVQ0tFVF9DT1VOVCAqIE1BWF9QQVJUSUNMRVNfUEVSX0JVQ0tFVCAqIDQpXG5cbmNvbnN0IHZzcmMgPSBcbmBcbnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0O1xuXG5hdHRyaWJ1dGUgdmVjMiBhX3ZlcnRpY2VzO1xuXG52b2lkIG1haW4gKCkge1xuICBnbF9Qb3NpdGlvbiA9IHZlYzQoYV92ZXJ0aWNlcywgMS4wLCAxLjApO1xufVxuYFxuXG5jb25zdCBmc3JjID1cbmBcbnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0O1xuXG51bmlmb3JtIGZsb2F0IHVfdGltZTtcbnVuaWZvcm0gZmxvYXQgdV9LO1xudW5pZm9ybSBmbG9hdCB1X1I7XG51bmlmb3JtIHZlYzMgdV9jb2xvcjtcbnVuaWZvcm0gZmxvYXQgdV9idWNrZXQ7XG51bmlmb3JtIHNhbXBsZXIyRCB1X3Bvc2l0aW9ucztcblxuY29uc3QgZmxvYXQgRFggPSAxLiAvICR7IE1BWF9QQVJUSUNMRVNfUEVSX0JVQ0tFVCB9LjtcbmNvbnN0IGZsb2F0IERZID0gMS4gLyAkeyBCVUNLRVRfQ09VTlQgfS47XG5jb25zdCBmbG9hdCBCVUNLRVRfWCA9ICR7IEJVQ0tFVF9YIH0uO1xuY29uc3QgZmxvYXQgQlVDS0VUX1kgPSAkeyBCVUNLRVRfWSB9LjtcbmNvbnN0IGZsb2F0IEFSRUFfWCA9ICR7IEFSRUFfWCB9LjtcbmNvbnN0IGZsb2F0IEFSRUFfWSA9ICR7IEFSRUFfWSB9LjtcblxuZmxvYXQgc2RmX3NwaGVyZSAoIGZsb2F0IHIsIHZlYzIgYywgdmVjMiBwICkge1xuICByZXR1cm4gZGlzdGFuY2UocCwgYykgLSByO1xufVxuXG5mbG9hdCB0b19idWNrZXRfaW5kZXggKCB2ZWMyIHAgKSB7XG4gIHJldHVybiBmbG9vcihtYXgoMC4sIHAueCAvIChBUkVBX1ggLyBCVUNLRVRfWCkpKSArXG4gICAgICAgICBmbG9vcihtYXgoMC4sIHAueSAvIChBUkVBX1kgLyBCVUNLRVRfWSkpKSAqIEJVQ0tFVF9ZO1xufVxuXG52b2lkIG1haW4gKCkge1xuICB2ZWMyIHAgPSBnbF9GcmFnQ29vcmQueHk7XG4gIHZlYzIgcG9zO1xuICB2ZWMyIHRleF9jb29yZDtcbiAgdmVjNCBwYXJ0aWNsZTtcbiAgZmxvYXQgYnVja2V0X2luZGV4ID0gdG9fYnVja2V0X2luZGV4KHApO1xuICBmbG9hdCB3ZWlnaHQgPSAwLjtcbiAgZmxvYXQgZGlzdCA9IDAuO1xuXG4gIGZvciAoIGZsb2F0IGkgPSAwLjsgaSA8IDEuOyBpICs9IERYICkge1xuICAgIHRleF9jb29yZC54ID0gaTtcbiAgICB0ZXhfY29vcmQueSA9IGJ1Y2tldF9pbmRleCAqIERZO1xuICAgIHBhcnRpY2xlID0gdGV4dHVyZTJEKHVfcG9zaXRpb25zLCB0ZXhfY29vcmQpO1xuICAgIHBvcyA9IHBhcnRpY2xlLnh5O1xuICAgIHdlaWdodCA9IHBhcnRpY2xlLnc7XG4gICAgZGlzdCArPSB3ZWlnaHQgKiBleHAoLXVfSyAqIHNkZl9zcGhlcmUodV9SLCBwb3MsIHApKTtcbiAgfVxuICBkaXN0ID0gbG9nKGRpc3QpIC8gdV9LO1xuICBmbG9hdCBvcGFjaXR5ID0gc3RlcCgwLiwgZGlzdCk7XG4gIGdsX0ZyYWdDb2xvciA9IHZlYzQodV9jb2xvciwgb3BhY2l0eSk7XG59XG5gXG5cbmNvbnN0IHZlcnRleCA9IGdsLmNyZWF0ZVNoYWRlcihnbC5WRVJURVhfU0hBREVSKVxuY29uc3QgZnJhZ21lbnQgPSBnbC5jcmVhdGVTaGFkZXIoZ2wuRlJBR01FTlRfU0hBREVSKVxuY29uc3QgcHJvZ3JhbSA9IGdsLmNyZWF0ZVByb2dyYW0oKVxuY29uc3Qgc2NyZWVuUXVhZCA9IG5ldyBGbG9hdDMyQXJyYXkoW1xuICAtMSwgMSwgLTEsIC0xLCAxLCAtMSxcbiAgLTEsIDEsIDEsIC0xLCAxLCAxXG5dKSBcbmNvbnN0IHF1YWRTaXplID0gc2NyZWVuUXVhZC5sZW5ndGggLyAyIFxuXG5pZiAoIHZlcnRleCA9PSBudWxsICYmIGZyYWdtZW50ID09IG51bGwgJiYgcHJvZ3JhbSA9PSBudWxsICkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ2dsIHJlc291cmNlcyBjb3VsZCBub3QgYmUgb2J0YWluZWQnKVxufVxuXG5nbC5zaGFkZXJTb3VyY2UodmVydGV4LCB2c3JjKVxuZ2wuY29tcGlsZVNoYWRlcih2ZXJ0ZXgpXG5nbC5zaGFkZXJTb3VyY2UoZnJhZ21lbnQsIGZzcmMpXG5nbC5jb21waWxlU2hhZGVyKGZyYWdtZW50KVxuXG5nbC5hdHRhY2hTaGFkZXIocHJvZ3JhbSwgdmVydGV4KVxuZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIGZyYWdtZW50KVxuZ2wubGlua1Byb2dyYW0ocHJvZ3JhbSlcbmdsLnVzZVByb2dyYW0ocHJvZ3JhbSlcblxuaWYgKCAhZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlcihwcm9ncmFtLCBnbC5MSU5LX1NUQVRVUykgKSB7XG4gIGNvbnNvbGUubG9nKGdsLmdldFNoYWRlckluZm9Mb2codmVydGV4KSlcbiAgY29uc29sZS5sb2coZ2wuZ2V0U2hhZGVySW5mb0xvZyhmcmFnbWVudCkpXG4gIGNvbnNvbGUubG9nKGdsLmdldFByb2dyYW1JbmZvTG9nKHByb2dyYW0pKVxufVxuXG5jb25zdCB2ZXJ0aWNlc0J1ZmZlciA9IGdsLmNyZWF0ZUJ1ZmZlcigpXG5jb25zdCBhX2xvY2F0aW9ucyA9IHtcbiAgYV92ZXJ0aWNlczogZ2wuZ2V0QXR0cmliTG9jYXRpb24ocHJvZ3JhbSwgJ2FfdmVydGljZXMnKVxufVxuY29uc3QgdV9sb2NhdGlvbnMgPSB7XG4gIHVfSzogZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sICd1X0snKSBhcyBXZWJHTFVuaWZvcm1Mb2NhdGlvbixcbiAgdV9SOiBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgJ3VfUicpIGFzIFdlYkdMVW5pZm9ybUxvY2F0aW9uLFxuICB1X2NvbG9yOiBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgJ3VfY29sb3InKSBhcyBXZWJHTFVuaWZvcm1Mb2NhdGlvbixcbiAgdV90aW1lOiBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgJ3VfdGltZScpIGFzIFdlYkdMVW5pZm9ybUxvY2F0aW9uLFxuICB1X3Bvc2l0aW9uczogZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sICd1X3Bvc2l0aW9ucycpIGFzIFdlYkdMVW5pZm9ybUxvY2F0aW9uLFxuICB1X2J1Y2tldDogZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sICd1X2J1Y2tldCcpIGFzIFdlYkdMVW5pZm9ybUxvY2F0aW9uXG59XG5jb25zdCBwcyA9IGdsLmNyZWF0ZVRleHR1cmUoKVxuXG5nbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgdmVydGljZXNCdWZmZXIpXG5nbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShhX2xvY2F0aW9ucy5hX3ZlcnRpY2VzKVxuZ2wudmVydGV4QXR0cmliUG9pbnRlcihhX2xvY2F0aW9ucy5hX3ZlcnRpY2VzLCAyLCBnbC5GTE9BVCwgZmFsc2UsIDAsIDApXG5nbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgc2NyZWVuUXVhZCwgZ2wuU1RBVElDX0RSQVcpXG5cbmdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTApXG5nbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBwcylcbmdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1MsIGdsLkNMQU1QX1RPX0VER0UpXG5nbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9ULCBnbC5DTEFNUF9UT19FREdFKVxuZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLk5FQVJFU1QpXG5nbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZ2wuTkVBUkVTVClcbmdsLnRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgZ2wuUkdCQSwgTUFYX1BBUlRJQ0xFU19QRVJfQlVDS0VULCBCVUNLRVRfQ09VTlQsIDAsIGdsLlJHQkEsIGdsLkZMT0FULCBwU29ydGVkKVxuXG5jYW52YXMud2lkdGggPSBBUkVBX1hcbmNhbnZhcy5oZWlnaHQgPSBBUkVBX1lcbmNhbnZhcy5zdHlsZS5ib3hTaXppbmcgPSAnYm9yZGVyLWJveCdcbmNhbnZhcy5zdHlsZS5ib3JkZXIgPSAnMnB4IHNvbGlkIENvcmFsJ1xuZG9jdW1lbnQuYm9keS5zdHlsZS5tYXJnaW4gPSAnMCdcbmRvY3VtZW50LmJvZHkuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ01pc3R5Um9zZSdcbmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKVxuXG5nbC52aWV3cG9ydCgwLCAwLCBBUkVBX1gsIEFSRUFfWSlcbmdsLmVuYWJsZShnbC5DVUxMX0ZBQ0UpXG5nbC5kaXNhYmxlKGdsLkRFUFRIX1RFU1QpXG5nbC5jbGVhckNvbG9yKDAsIDAsIDAsIDApXG5nbC51c2VQcm9ncmFtKHByb2dyYW0pXG5cbmNvbnN0IHJhZiA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbmNvbnN0IGNsb2NrID0geyB0aGVuOiBEYXRlLm5vdygpLCBub3c6IERhdGUubm93KCkgfVxuXG5mb3IgKCB2YXIgaSA9IDA7IGkgPCBwb3NpdGlvbnMubGVuZ3RoOyBpICs9IDQgKSB7XG4gIHBvc2l0aW9uc1tpXSA9IHJhbmROdW0oMCwgQVJFQV9YKVxuICBwb3NpdGlvbnNbaSArIDFdID0gcmFuZE51bSgwLCBBUkVBX1kpXG59XG5cbmZ1bmN0aW9uIGdldEJ1Y2tldEluZGV4ICggeDogbnVtYmVyLCB5OiBudW1iZXIgKTogbnVtYmVyIHtcbiAgaWYgICAgICAoIHggPCAwIHx8IHkgPiBBUkVBX1ggKSByZXR1cm4gLTFcbiAgZWxzZSBpZiAoIHkgPCAwIHx8IHkgPiBBUkVBX1kgKSByZXR1cm4gLTFcbiAgZWxzZSAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLm1heCgwLCB4IC8gKEFSRUFfWCAvIEJVQ0tFVF9YKSkpICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5mbG9vcihNYXRoLm1heCgwLCB5IC8gKEFSRUFfWSAvIEJVQ0tFVF9ZKSkpICogQlVDS0VUX1lcbn1cblxucmFmKGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgY2xvY2sudGhlbiA9IGNsb2NrLm5vd1xuICBjbG9jay5ub3cgPSBEYXRlLm5vdygpXG5cbiAgYWN0aXZlSW5kaWNlcy5maWxsKDApXG4gIHBTb3J0ZWQuZmlsbCgwKVxuXG4gIGZvciAoIHZhciBpID0gMCwgRyA9IC1zZXR0aW5ncy5HLCBkVCA9IDAuMDE7IGkgPCBwb3NpdGlvbnMubGVuZ3RoOyBpICs9IDQgKSB7XG4gICAgaWYgKCBwb3NpdGlvbnNbIGkgKyAxIF0gPCBNYXRoLnJhbmRvbSgpICogLTEwMCApIHtcbiAgICAgIHZlbG9jaXRpZXNbaV0gPSByYW5kTnVtKC0yMDAsIDIwMClcbiAgICAgIHZlbG9jaXRpZXNbaSArIDFdID0gcmFuZE51bSg4MDAsIDEyMDApXG4gICAgICBwb3NpdGlvbnNbaV0gPSBBUkVBX1ggLyAyXG4gICAgICBwb3NpdGlvbnNbaSArIDFdID0gMFxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHZlbG9jaXRpZXNbaSArIDFdICs9IGRUICogR1xuICAgICAgcG9zaXRpb25zW2ldICs9IGRUICogdmVsb2NpdGllc1tpXVxuICAgICAgcG9zaXRpb25zW2kgKyAxXSArPSBkVCAqIHZlbG9jaXRpZXNbaSArIDFdXG4gICAgfVxuICAgIHZhciBweCA9IHBvc2l0aW9uc1tpXVxuICAgIHZhciBweSA9IHBvc2l0aW9uc1tpICsgMV1cbiAgICB2YXIgYkluZGV4ID0gZ2V0QnVja2V0SW5kZXgocHgsIHB5KVxuXG4gICAgaWYgKCBiSW5kZXggPT0gLTEgKSBjb250aW51ZVxuXG4gICAgZm9yICggdmFyIGsgPSAtc2V0dGluZ3MuY2VsbFNpemU7IGsgPD0gc2V0dGluZ3MuY2VsbFNpemU7IGsrKyApIHtcbiAgICAgIGZvciAoIHZhciBsID0gLXNldHRpbmdzLmNlbGxTaXplOyBsIDw9IHNldHRpbmdzLmNlbGxTaXplOyBsKysgKSB7XG4gICAgICAgIHZhciBpbmRleCA9IGJJbmRleCAtIGwgLSBrICogQlVDS0VUX1hcbiAgICAgICAgdmFyIGFJbmRleCA9IGFjdGl2ZUluZGljZXNbaW5kZXhdXG5cbiAgICAgICAgaWYgKCBhSW5kZXggPT0gbnVsbCApIGNvbnRpbnVlXG5cbiAgICAgICAgdmFyIGJTdGFydCA9IGluZGV4ICogTUFYX1BBUlRJQ0xFU19QRVJfQlVDS0VUICogNFxuICAgICAgICB2YXIgYU9mZnNldCA9IGFJbmRleCAqIDRcbiAgICAgICAgdmFyIHNJbmRleCA9IGJTdGFydCArIGFPZmZzZXRcblxuICAgICAgICBwU29ydGVkW3NJbmRleF0gPSBweFxuICAgICAgICBwU29ydGVkW3NJbmRleCArIDFdID0gcHlcbiAgICAgICAgcFNvcnRlZFtzSW5kZXggKyAzXSA9IDFcbiAgICAgICAgYWN0aXZlSW5kaWNlc1tpbmRleF0gPSBNYXRoLm1pbihhSW5kZXggKyAxLCBNQVhfUEFSVElDTEVTX1BFUl9CVUNLRVQgLSAxKVxuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCB8IGdsLkRFUFRIX0JVRkZFUl9CSVQpXG4gIGdsLnVuaWZvcm0xZih1X2xvY2F0aW9ucy51X3RpbWUsIGNsb2NrLm5vdylcbiAgZ2wudW5pZm9ybTFmKHVfbG9jYXRpb25zLnVfSywgc2V0dGluZ3MuSylcbiAgZ2wudW5pZm9ybTFmKHVfbG9jYXRpb25zLnVfUiwgc2V0dGluZ3MuUilcbiAgZ2wudW5pZm9ybTNmKHVfbG9jYXRpb25zLnVfY29sb3IsIHNldHRpbmdzLmNvbG9yWzBdLCBzZXR0aW5ncy5jb2xvclsxXSwgc2V0dGluZ3MuY29sb3JbMl0pXG4gIGdsLnVuaWZvcm0xaSh1X2xvY2F0aW9ucy51X3Bvc2l0aW9ucywgMClcbiAgZ2wudGV4SW1hZ2UyRChnbC5URVhUVVJFXzJELCAwLCBnbC5SR0JBLCBNQVhfUEFSVElDTEVTX1BFUl9CVUNLRVQsIEJVQ0tFVF9DT1VOVCwgMCwgZ2wuUkdCQSwgZ2wuRkxPQVQsIHBTb3J0ZWQpXG4gIGdsLmRyYXdBcnJheXMoZ2wuVFJJQU5HTEVTLCAwLCBxdWFkU2l6ZSlcbiAgcmFmKHJlbmRlcilcbn0pXG4iLCJleHBvcnQgZnVuY3Rpb24gcmFuZEludCAoIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlciApOiBudW1iZXIge1xuICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKCBtYXggLSBtaW4gKSArIG1pbilcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJhbmROdW0gKCBtaW46IG51bWJlciwgbWF4OiBudW1iZXIgKTogbnVtYmVyIHtcbiAgcmV0dXJuIE1hdGgucmFuZG9tKCkgKiAoIG1heCAtIG1pbiApICsgbWluXG59XG4iXX0=
