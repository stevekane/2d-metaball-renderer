(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/// <reference path="../typings/index.d.ts" />
"use strict";
var random_1 = require("./utils/random");
var canvas = document.createElement('canvas');
var gl = canvas.getContext('webgl');
if (gl == null) {
    throw new Error('gl context could not be obtained');
}
if (gl.getExtension('OES_texture_float') == null) {
    throw new Error('FLOAT Texture extension not available');
}
var settings = {
    K: 0.2,
    G: 980,
    R: .2,
    color: [.2, .4, .8],
};
var COUNT = 2048;
var positions = new Float32Array(COUNT * 4);
var velocities = new Float32Array(COUNT * 4);
var AREA_X = 400;
var AREA_Y = 400;
var BUCKET_X = 32;
var BUCKET_Y = 32;
var BUCKET_COUNT = BUCKET_X * BUCKET_Y;
var MAX_PARTICLES_PER_BUCKET = 64;
var activeIndices = new Int32Array(BUCKET_COUNT);
var pSorted = new Float32Array(BUCKET_COUNT * MAX_PARTICLES_PER_BUCKET * 4);
var vsrc = "\nprecision mediump float;\n\nattribute vec2 a_vertices;\n\nvoid main () {\n  gl_Position = vec4(a_vertices, 1.0, 1.0);\n}\n";
var fsrc = "\nprecision mediump float;\n\nuniform float u_time;\nuniform float u_K;\nuniform float u_R;\nuniform vec3 u_color;\nuniform float u_bucket;\nuniform sampler2D u_positions;\n\nconst float DX = 1. / " + MAX_PARTICLES_PER_BUCKET + ".;\nconst float DY = 1. / " + BUCKET_COUNT + ".;\nconst float BUCKET_X = " + BUCKET_X + ".;\nconst float BUCKET_Y = " + BUCKET_Y + ".;\nconst float AREA_X = " + AREA_X + ".;\nconst float AREA_Y = " + AREA_Y + ".;\n\nfloat sdf_sphere ( float r, vec2 c, vec2 p ) {\n  return distance(p, c) - r;\n}\n\nfloat to_bucket_index ( vec2 p ) {\n  return floor(max(0., p.x / (AREA_X / BUCKET_X))) +\n         floor(max(0., p.y / (AREA_Y / BUCKET_Y))) * BUCKET_Y;\n}\n\nvoid main () {\n  vec2 p = gl_FragCoord.xy;\n  vec2 pos;\n  vec2 tex_coord;\n  vec4 particle;\n  float bucket_index = to_bucket_index(p);\n  float weight = 0.;\n  float dist = 0.;\n\n  for ( float i = 0.; i < 1.; i += DX ) {\n    tex_coord.x = i;\n    tex_coord.y = bucket_index * DY;\n    particle = texture2D(u_positions, tex_coord);\n    pos = particle.xy;\n    weight = particle.w;\n    dist += weight * exp(-u_K * sdf_sphere(u_R, pos, p));\n  }\n  dist = log(dist) / u_K;\n  float opacity = step(0., dist);\n  gl_FragColor = vec4(u_color, opacity);\n}\n";
var vertex = gl.createShader(gl.VERTEX_SHADER);
var fragment = gl.createShader(gl.FRAGMENT_SHADER);
var program = gl.createProgram();
var screenQuad = new Float32Array([
    -1, 1, -1, -1, 1, -1,
    -1, 1, 1, -1, 1, 1
]);
var quadSize = screenQuad.length / 2;
if (vertex == null && fragment == null && program == null) {
    throw new Error('gl resources could not be obtained');
}
gl.shaderSource(vertex, vsrc);
gl.compileShader(vertex);
gl.shaderSource(fragment, fsrc);
gl.compileShader(fragment);
gl.attachShader(program, vertex);
gl.attachShader(program, fragment);
gl.linkProgram(program);
gl.useProgram(program);
if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
    console.log(gl.getShaderInfoLog(vertex));
    console.log(gl.getShaderInfoLog(fragment));
    console.log(gl.getProgramInfoLog(program));
}
var verticesBuffer = gl.createBuffer();
var a_locations = {
    a_vertices: gl.getAttribLocation(program, 'a_vertices')
};
var u_locations = {
    u_K: gl.getUniformLocation(program, 'u_K'),
    u_R: gl.getUniformLocation(program, 'u_R'),
    u_color: gl.getUniformLocation(program, 'u_color'),
    u_time: gl.getUniformLocation(program, 'u_time'),
    u_positions: gl.getUniformLocation(program, 'u_positions'),
    u_bucket: gl.getUniformLocation(program, 'u_bucket')
};
var ps = gl.createTexture();
gl.bindBuffer(gl.ARRAY_BUFFER, verticesBuffer);
gl.enableVertexAttribArray(a_locations.a_vertices);
gl.vertexAttribPointer(a_locations.a_vertices, 2, gl.FLOAT, false, 0, 0);
gl.bufferData(gl.ARRAY_BUFFER, screenQuad, gl.STATIC_DRAW);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, ps);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, MAX_PARTICLES_PER_BUCKET, BUCKET_COUNT, 0, gl.RGBA, gl.FLOAT, pSorted);
canvas.width = AREA_X;
canvas.height = AREA_Y;
canvas.style.boxSizing = 'border-box';
canvas.style.border = '2px solid Coral';
document.body.style.margin = '0';
document.body.style.backgroundColor = 'MistyRose';
document.body.appendChild(canvas);
gl.viewport(0, 0, AREA_X, AREA_Y);
gl.enable(gl.CULL_FACE);
gl.disable(gl.DEPTH_TEST);
// gl.enable(gl.BLEND)
// gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)
gl.clearColor(0, 0, 0, 0);
gl.useProgram(program);
var raf = window.requestAnimationFrame;
var clock = { then: Date.now(), now: Date.now() };
for (var i = 0; i < positions.length; i += 4) {
    positions[i] = random_1.randNum(0, 400);
    positions[i + 1] = random_1.randNum(0, 100);
    velocities[i] = random_1.randNum(-300, 300);
    velocities[i + 1] = random_1.randNum(100, 600);
}
// TODO: uses globals for simplicity atm
function getBucketIndex(x, y) {
    if (x < 0 || y > AREA_X)
        return -1;
    else if (y < 0 || y > AREA_Y)
        return -1;
    else
        return Math.floor(Math.max(0, x / (AREA_X / BUCKET_X))) +
            Math.floor(Math.max(0, y / (AREA_Y / BUCKET_Y))) * BUCKET_Y;
}
function printSorted(s) {
    var msg = '';
    for (var i = 0; i < s.length / 4; i++) {
        var w = s[i * 4 + 3];
        var nl = i % MAX_PARTICLES_PER_BUCKET == 0;
        msg += nl ? '\n' : '';
        msg += w;
    }
    console.log(msg);
}
raf(function render() {
    clock.then = clock.now;
    clock.now = Date.now();
    activeIndices.fill(0);
    pSorted.fill(0);
    for (var i = 0, G = -settings.G, dT = 0.01; i < positions.length; i += 4) {
        if (positions[i + 1] < Math.random() * -100) {
            velocities[i + 1] = random_1.randNum(600, 900);
            positions[i] = AREA_X / 2;
            positions[i + 1] = 0;
        }
        else {
            velocities[i + 1] += dT * G;
            positions[i] += dT * velocities[i];
            positions[i + 1] += dT * velocities[i + 1];
        }
        var px = positions[i];
        var py = positions[i + 1];
        var bIndex = getBucketIndex(px, py);
        if (bIndex == -1)
            continue;
        for (var k = -1; k <= 1; k++) {
            for (var l = -1; l <= 1; l++) {
                var index = bIndex - l - k * BUCKET_X;
                var aIndex = activeIndices[index];
                if (aIndex == null)
                    continue;
                var bStart = index * MAX_PARTICLES_PER_BUCKET * 4;
                var aOffset = aIndex * 4;
                var sIndex = bStart + aOffset;
                pSorted[sIndex] = px;
                pSorted[sIndex + 1] = py;
                pSorted[sIndex + 3] = 1;
                activeIndices[index] = Math.min(aIndex + 1, MAX_PARTICLES_PER_BUCKET - 1);
            }
        }
    }
    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
    gl.uniform1f(u_locations.u_time, clock.now);
    gl.uniform1f(u_locations.u_K, settings.K);
    gl.uniform1f(u_locations.u_R, settings.R);
    gl.uniform3f(u_locations.u_color, settings.color[0], settings.color[1], settings.color[2]);
    gl.uniform1i(u_locations.u_positions, 0);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, MAX_PARTICLES_PER_BUCKET, BUCKET_COUNT, 0, gl.RGBA, gl.FLOAT, pSorted);
    gl.drawArrays(gl.TRIANGLES, 0, quadSize);
    raf(render);
});

},{"./utils/random":2}],2:[function(require,module,exports){
"use strict";
function randInt(min, max) {
    return Math.floor(Math.random() * (max - min) + min);
}
exports.randInt = randInt;
function randNum(min, max) {
    return Math.random() * (max - min) + min;
}
exports.randNum = randNum;

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Vzci9saWIvbm9kZV9tb2R1bGVzL3dhdGNoaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbWFpbi50cyIsInNyYy91dGlscy9yYW5kb20udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQSw4Q0FBOEM7O0FBRTlDLHlDQUFpRDtBQUdqRCxJQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0FBQy9DLElBQU0sRUFBRSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUE7QUFFckMsRUFBRSxDQUFDLENBQUUsRUFBRSxJQUFJLElBQUssQ0FBQyxDQUFDLENBQUM7SUFDakIsTUFBTSxJQUFJLEtBQUssQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFBO0FBQ3JELENBQUM7QUFFRCxFQUFFLENBQUMsQ0FBRSxFQUFFLENBQUMsWUFBWSxDQUFDLG1CQUFtQixDQUFDLElBQUksSUFBSyxDQUFDLENBQUMsQ0FBQztJQUNuRCxNQUFNLElBQUksS0FBSyxDQUFDLHVDQUF1QyxDQUFDLENBQUE7QUFDMUQsQ0FBQztBQUVELElBQU0sUUFBUSxHQUFHO0lBQ2YsQ0FBQyxFQUFFLEdBQUc7SUFDTixDQUFDLEVBQUUsR0FBRztJQUNOLENBQUMsRUFBRSxFQUFFO0lBQ0wsS0FBSyxFQUFFLENBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUU7Q0FDdEIsQ0FBQTtBQUNELElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQTtBQUNsQixJQUFNLFNBQVMsR0FBRyxJQUFJLFlBQVksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUE7QUFDN0MsSUFBTSxVQUFVLEdBQUcsSUFBSSxZQUFZLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFBO0FBQzlDLElBQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQTtBQUNsQixJQUFNLE1BQU0sR0FBRyxHQUFHLENBQUE7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SSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUUsR0FBRyxHQUFHLEdBQUcsQ0FBRSxHQUFHLEdBQUcsQ0FBQTtBQUM1QyxDQUFDO0FBRkQsMEJBRUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGluZ3MvaW5kZXguZC50c1wiIC8+XG5cbmltcG9ydCB7IHJhbmRJbnQsIHJhbmROdW0gfSBmcm9tICcuL3V0aWxzL3JhbmRvbSdcbmltcG9ydCB7IHdyYXAgfSBmcm9tICcuL3V0aWxzL3JhbmdlJ1xuXG5jb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKVxuY29uc3QgZ2wgPSBjYW52YXMuZ2V0Q29udGV4dCgnd2ViZ2wnKVxuXG5pZiAoIGdsID09IG51bGwgKSB7XG4gIHRocm93IG5ldyBFcnJvcignZ2wgY29udGV4dCBjb3VsZCBub3QgYmUgb2J0YWluZWQnKVxufVxuXG5pZiAoIGdsLmdldEV4dGVuc2lvbignT0VTX3RleHR1cmVfZmxvYXQnKSA9PSBudWxsICkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ0ZMT0FUIFRleHR1cmUgZXh0ZW5zaW9uIG5vdCBhdmFpbGFibGUnKSBcbn1cblxuY29uc3Qgc2V0dGluZ3MgPSB7XG4gIEs6IDAuMixcbiAgRzogOTgwLCBcbiAgUjogLjIsXG4gIGNvbG9yOiBbIC4yLCAuNCwgLjggXSxcbn1cbmNvbnN0IENPVU5UID0gMjA0OFxuY29uc3QgcG9zaXRpb25zID0gbmV3IEZsb2F0MzJBcnJheShDT1VOVCAqIDQpXG5jb25zdCB2ZWxvY2l0aWVzID0gbmV3IEZsb2F0MzJBcnJheShDT1VOVCAqIDQpXG5jb25zdCBBUkVBX1ggPSA0MDBcbmNvbnN0IEFSRUFfWSA9IDQwMFxuY29uc3QgQlVDS0VUX1ggPSAzMlxuY29uc3QgQlVDS0VUX1kgPSAzMlxuY29uc3QgQlVDS0VUX0NPVU5UID0gQlVDS0VUX1ggKiBCVUNLRVRfWVxuY29uc3QgTUFYX1BBUlRJQ0xFU19QRVJfQlVDS0VUID0gNjRcbmNvbnN0IGFjdGl2ZUluZGljZXMgPSBuZXcgSW50MzJBcnJheShCVUNLRVRfQ09VTlQpXG5jb25zdCBwU29ydGVkID0gbmV3IEZsb2F0MzJBcnJheShCVUNLRVRfQ09VTlQgKiBNQVhfUEFSVElDTEVTX1BFUl9CVUNLRVQgKiA0KVxuXG5jb25zdCB2c3JjID0gXG5gXG5wcmVjaXNpb24gbWVkaXVtcCBmbG9hdDtcblxuYXR0cmlidXRlIHZlYzIgYV92ZXJ0aWNlcztcblxudm9pZCBtYWluICgpIHtcbiAgZ2xfUG9zaXRpb24gPSB2ZWM0KGFfdmVydGljZXMsIDEuMCwgMS4wKTtcbn1cbmBcblxuY29uc3QgZnNyYyA9XG5gXG5wcmVjaXNpb24gbWVkaXVtcCBmbG9hdDtcblxudW5pZm9ybSBmbG9hdCB1X3RpbWU7XG51bmlmb3JtIGZsb2F0IHVfSztcbnVuaWZvcm0gZmxvYXQgdV9SO1xudW5pZm9ybSB2ZWMzIHVfY29sb3I7XG51bmlmb3JtIGZsb2F0IHVfYnVja2V0O1xudW5pZm9ybSBzYW1wbGVyMkQgdV9wb3NpdGlvbnM7XG5cbmNvbnN0IGZsb2F0IERYID0gMS4gLyAkeyBNQVhfUEFSVElDTEVTX1BFUl9CVUNLRVQgfS47XG5jb25zdCBmbG9hdCBEWSA9IDEuIC8gJHsgQlVDS0VUX0NPVU5UIH0uO1xuY29uc3QgZmxvYXQgQlVDS0VUX1ggPSAkeyBCVUNLRVRfWCB9LjtcbmNvbnN0IGZsb2F0IEJVQ0tFVF9ZID0gJHsgQlVDS0VUX1kgfS47XG5jb25zdCBmbG9hdCBBUkVBX1ggPSAkeyBBUkVBX1ggfS47XG5jb25zdCBmbG9hdCBBUkVBX1kgPSAkeyBBUkVBX1kgfS47XG5cbmZsb2F0IHNkZl9zcGhlcmUgKCBmbG9hdCByLCB2ZWMyIGMsIHZlYzIgcCApIHtcbiAgcmV0dXJuIGRpc3RhbmNlKHAsIGMpIC0gcjtcbn1cblxuZmxvYXQgdG9fYnVja2V0X2luZGV4ICggdmVjMiBwICkge1xuICByZXR1cm4gZmxvb3IobWF4KDAuLCBwLnggLyAoQVJFQV9YIC8gQlVDS0VUX1gpKSkgK1xuICAgICAgICAgZmxvb3IobWF4KDAuLCBwLnkgLyAoQVJFQV9ZIC8gQlVDS0VUX1kpKSkgKiBCVUNLRVRfWTtcbn1cblxudm9pZCBtYWluICgpIHtcbiAgdmVjMiBwID0gZ2xfRnJhZ0Nvb3JkLnh5O1xuICB2ZWMyIHBvcztcbiAgdmVjMiB0ZXhfY29vcmQ7XG4gIHZlYzQgcGFydGljbGU7XG4gIGZsb2F0IGJ1Y2tldF9pbmRleCA9IHRvX2J1Y2tldF9pbmRleChwKTtcbiAgZmxvYXQgd2VpZ2h0ID0gMC47XG4gIGZsb2F0IGRpc3QgPSAwLjtcblxuICBmb3IgKCBmbG9hdCBpID0gMC47IGkgPCAxLjsgaSArPSBEWCApIHtcbiAgICB0ZXhfY29vcmQueCA9IGk7XG4gICAgdGV4X2Nvb3JkLnkgPSBidWNrZXRfaW5kZXggKiBEWTtcbiAgICBwYXJ0aWNsZSA9IHRleHR1cmUyRCh1X3Bvc2l0aW9ucywgdGV4X2Nvb3JkKTtcbiAgICBwb3MgPSBwYXJ0aWNsZS54eTtcbiAgICB3ZWlnaHQgPSBwYXJ0aWNsZS53O1xuICAgIGRpc3QgKz0gd2VpZ2h0ICogZXhwKC11X0sgKiBzZGZfc3BoZXJlKHVfUiwgcG9zLCBwKSk7XG4gIH1cbiAgZGlzdCA9IGxvZyhkaXN0KSAvIHVfSztcbiAgZmxvYXQgb3BhY2l0eSA9IHN0ZXAoMC4sIGRpc3QpO1xuICBnbF9GcmFnQ29sb3IgPSB2ZWM0KHVfY29sb3IsIG9wYWNpdHkpO1xufVxuYFxuXG5jb25zdCB2ZXJ0ZXggPSBnbC5jcmVhdGVTaGFkZXIoZ2wuVkVSVEVYX1NIQURFUilcbmNvbnN0IGZyYWdtZW50ID0gZ2wuY3JlYXRlU2hhZGVyKGdsLkZSQUdNRU5UX1NIQURFUilcbmNvbnN0IHByb2dyYW0gPSBnbC5jcmVhdGVQcm9ncmFtKClcbmNvbnN0IHNjcmVlblF1YWQgPSBuZXcgRmxvYXQzMkFycmF5KFtcbiAgLTEsIDEsIC0xLCAtMSwgMSwgLTEsXG4gIC0xLCAxLCAxLCAtMSwgMSwgMVxuXSkgXG5jb25zdCBxdWFkU2l6ZSA9IHNjcmVlblF1YWQubGVuZ3RoIC8gMiBcblxuaWYgKCB2ZXJ0ZXggPT0gbnVsbCAmJiBmcmFnbWVudCA9PSBudWxsICYmIHByb2dyYW0gPT0gbnVsbCApIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdnbCByZXNvdXJjZXMgY291bGQgbm90IGJlIG9idGFpbmVkJylcbn1cblxuZ2wuc2hhZGVyU291cmNlKHZlcnRleCwgdnNyYylcbmdsLmNvbXBpbGVTaGFkZXIodmVydGV4KVxuZ2wuc2hhZGVyU291cmNlKGZyYWdtZW50LCBmc3JjKVxuZ2wuY29tcGlsZVNoYWRlcihmcmFnbWVudClcblxuZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIHZlcnRleClcbmdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCBmcmFnbWVudClcbmdsLmxpbmtQcm9ncmFtKHByb2dyYW0pXG5nbC51c2VQcm9ncmFtKHByb2dyYW0pXG5cbmlmICggIWdsLmdldFByb2dyYW1QYXJhbWV0ZXIocHJvZ3JhbSwgZ2wuTElOS19TVEFUVVMpICkge1xuICBjb25zb2xlLmxvZyhnbC5nZXRTaGFkZXJJbmZvTG9nKHZlcnRleCkpXG4gIGNvbnNvbGUubG9nKGdsLmdldFNoYWRlckluZm9Mb2coZnJhZ21lbnQpKVxuICBjb25zb2xlLmxvZyhnbC5nZXRQcm9ncmFtSW5mb0xvZyhwcm9ncmFtKSlcbn1cblxuY29uc3QgdmVydGljZXNCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKVxuY29uc3QgYV9sb2NhdGlvbnMgPSB7XG4gIGFfdmVydGljZXM6IGdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sICdhX3ZlcnRpY2VzJylcbn1cbmNvbnN0IHVfbG9jYXRpb25zID0ge1xuICB1X0s6IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCAndV9LJykgYXMgV2ViR0xVbmlmb3JtTG9jYXRpb24sXG4gIHVfUjogZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sICd1X1InKSBhcyBXZWJHTFVuaWZvcm1Mb2NhdGlvbixcbiAgdV9jb2xvcjogZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sICd1X2NvbG9yJykgYXMgV2ViR0xVbmlmb3JtTG9jYXRpb24sXG4gIHVfdGltZTogZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sICd1X3RpbWUnKSBhcyBXZWJHTFVuaWZvcm1Mb2NhdGlvbixcbiAgdV9wb3NpdGlvbnM6IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCAndV9wb3NpdGlvbnMnKSBhcyBXZWJHTFVuaWZvcm1Mb2NhdGlvbixcbiAgdV9idWNrZXQ6IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCAndV9idWNrZXQnKSBhcyBXZWJHTFVuaWZvcm1Mb2NhdGlvblxufVxuY29uc3QgcHMgPSBnbC5jcmVhdGVUZXh0dXJlKClcblxuZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHZlcnRpY2VzQnVmZmVyKVxuZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoYV9sb2NhdGlvbnMuYV92ZXJ0aWNlcylcbmdsLnZlcnRleEF0dHJpYlBvaW50ZXIoYV9sb2NhdGlvbnMuYV92ZXJ0aWNlcywgMiwgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKVxuZ2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIHNjcmVlblF1YWQsIGdsLlNUQVRJQ19EUkFXKVxuXG5nbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwKVxuZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgcHMpXG5nbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9TLCBnbC5DTEFNUF9UT19FREdFKVxuZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfVCwgZ2wuQ0xBTVBfVE9fRURHRSlcbmdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5ORUFSRVNUKVxuZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01BR19GSUxURVIsIGdsLk5FQVJFU1QpXG5nbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAsIGdsLlJHQkEsIE1BWF9QQVJUSUNMRVNfUEVSX0JVQ0tFVCwgQlVDS0VUX0NPVU5ULCAwLCBnbC5SR0JBLCBnbC5GTE9BVCwgcFNvcnRlZClcblxuY2FudmFzLndpZHRoID0gQVJFQV9YXG5jYW52YXMuaGVpZ2h0ID0gQVJFQV9ZXG5jYW52YXMuc3R5bGUuYm94U2l6aW5nID0gJ2JvcmRlci1ib3gnXG5jYW52YXMuc3R5bGUuYm9yZGVyID0gJzJweCBzb2xpZCBDb3JhbCdcbmRvY3VtZW50LmJvZHkuc3R5bGUubWFyZ2luID0gJzAnXG5kb2N1bWVudC5ib2R5LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdNaXN0eVJvc2UnXG5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhcylcblxuZ2wudmlld3BvcnQoMCwgMCwgQVJFQV9YLCBBUkVBX1kpXG5nbC5lbmFibGUoZ2wuQ1VMTF9GQUNFKVxuZ2wuZGlzYWJsZShnbC5ERVBUSF9URVNUKVxuLy8gZ2wuZW5hYmxlKGdsLkJMRU5EKVxuLy8gZ2wuYmxlbmRGdW5jKGdsLlNSQ19BTFBIQSwgZ2wuT05FX01JTlVTX1NSQ19BTFBIQSlcbmdsLmNsZWFyQ29sb3IoMCwgMCwgMCwgMClcbmdsLnVzZVByb2dyYW0ocHJvZ3JhbSlcblxuY29uc3QgcmFmID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZVxuY29uc3QgY2xvY2sgPSB7IHRoZW46IERhdGUubm93KCksIG5vdzogRGF0ZS5ub3coKSB9XG5cbmZvciAoIHZhciBpID0gMDsgaSA8IHBvc2l0aW9ucy5sZW5ndGg7IGkgKz0gNCApIHtcbiAgcG9zaXRpb25zW2ldID0gcmFuZE51bSgwLCA0MDApXG4gIHBvc2l0aW9uc1tpICsgMV0gPSByYW5kTnVtKDAsIDEwMCkgXG4gIHZlbG9jaXRpZXNbaV0gPSByYW5kTnVtKC0zMDAsIDMwMClcbiAgdmVsb2NpdGllc1tpICsgMV0gPSByYW5kTnVtKDEwMCwgNjAwKVxufVxuXG4vLyBUT0RPOiB1c2VzIGdsb2JhbHMgZm9yIHNpbXBsaWNpdHkgYXRtXG5mdW5jdGlvbiBnZXRCdWNrZXRJbmRleCAoIHg6IG51bWJlciwgeTogbnVtYmVyICk6IG51bWJlciB7XG4gIGlmICAgICAgKCB4IDwgMCB8fCB5ID4gQVJFQV9YICkgcmV0dXJuIC0xXG4gIGVsc2UgaWYgKCB5IDwgMCB8fCB5ID4gQVJFQV9ZICkgcmV0dXJuIC0xXG4gIGVsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5tYXgoMCwgeCAvIChBUkVBX1ggLyBCVUNLRVRfWCkpKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5tYXgoMCwgeSAvIChBUkVBX1kgLyBCVUNLRVRfWSkpKSAqIEJVQ0tFVF9ZXG59XG5cbmZ1bmN0aW9uIHByaW50U29ydGVkICggczogRmxvYXQzMkFycmF5ICkge1xuICB2YXIgbXNnID0gJydcblxuICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBzLmxlbmd0aCAvIDQ7IGkrKyApIHtcbiAgICB2YXIgdyA9IHNbaSAqIDQgKyAzXVxuICAgIHZhciBubCA9IGkgJSBNQVhfUEFSVElDTEVTX1BFUl9CVUNLRVQgPT0gMFxuXG4gICAgbXNnICs9IG5sID8gJ1xcbicgOiAnJ1xuICAgIG1zZyArPSB3XG4gIH1cbiAgY29uc29sZS5sb2cobXNnKVxufVxuXG5yYWYoZnVuY3Rpb24gcmVuZGVyKCkge1xuICBjbG9jay50aGVuID0gY2xvY2subm93XG4gIGNsb2NrLm5vdyA9IERhdGUubm93KClcblxuICBhY3RpdmVJbmRpY2VzLmZpbGwoMClcbiAgcFNvcnRlZC5maWxsKDApXG5cbiAgZm9yICggdmFyIGkgPSAwLCBHID0gLXNldHRpbmdzLkcsIGRUID0gMC4wMTsgaSA8IHBvc2l0aW9ucy5sZW5ndGg7IGkgKz0gNCApIHtcbiAgICBpZiAoIHBvc2l0aW9uc1sgaSArIDEgXSA8IE1hdGgucmFuZG9tKCkgKiAtMTAwICkge1xuICAgICAgdmVsb2NpdGllc1tpICsgMV0gPSByYW5kTnVtKDYwMCwgOTAwKVxuICAgICAgcG9zaXRpb25zW2ldID0gQVJFQV9YIC8gMlxuICAgICAgcG9zaXRpb25zW2kgKyAxXSA9IDBcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB2ZWxvY2l0aWVzW2kgKyAxXSArPSBkVCAqIEdcbiAgICAgIHBvc2l0aW9uc1tpXSArPSBkVCAqIHZlbG9jaXRpZXNbaV1cbiAgICAgIHBvc2l0aW9uc1tpICsgMV0gKz0gZFQgKiB2ZWxvY2l0aWVzW2kgKyAxXVxuICAgIH1cbiAgICB2YXIgcHggPSBwb3NpdGlvbnNbaV1cbiAgICB2YXIgcHkgPSBwb3NpdGlvbnNbaSArIDFdXG4gICAgdmFyIGJJbmRleCA9IGdldEJ1Y2tldEluZGV4KHB4LCBweSlcblxuICAgIGlmICggYkluZGV4ID09IC0xICkgY29udGludWVcblxuICAgIGZvciAoIHZhciBrID0gLTE7IGsgPD0gMTsgaysrICkge1xuICAgICAgZm9yICggdmFyIGwgPSAtMTsgbCA8PSAxOyBsKysgKSB7XG4gICAgICAgIHZhciBpbmRleCA9IGJJbmRleCAtIGwgLSBrICogQlVDS0VUX1hcbiAgICAgICAgdmFyIGFJbmRleCA9IGFjdGl2ZUluZGljZXNbaW5kZXhdXG5cbiAgICAgICAgaWYgKCBhSW5kZXggPT0gbnVsbCApIGNvbnRpbnVlXG5cbiAgICAgICAgdmFyIGJTdGFydCA9IGluZGV4ICogTUFYX1BBUlRJQ0xFU19QRVJfQlVDS0VUICogNFxuICAgICAgICB2YXIgYU9mZnNldCA9IGFJbmRleCAqIDRcbiAgICAgICAgdmFyIHNJbmRleCA9IGJTdGFydCArIGFPZmZzZXRcblxuICAgICAgICBwU29ydGVkW3NJbmRleF0gPSBweFxuICAgICAgICBwU29ydGVkW3NJbmRleCArIDFdID0gcHlcbiAgICAgICAgcFNvcnRlZFtzSW5kZXggKyAzXSA9IDFcbiAgICAgICAgYWN0aXZlSW5kaWNlc1tpbmRleF0gPSBNYXRoLm1pbihhSW5kZXggKyAxLCBNQVhfUEFSVElDTEVTX1BFUl9CVUNLRVQgLSAxKVxuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCB8IGdsLkRFUFRIX0JVRkZFUl9CSVQpXG4gIGdsLnVuaWZvcm0xZih1X2xvY2F0aW9ucy51X3RpbWUsIGNsb2NrLm5vdylcbiAgZ2wudW5pZm9ybTFmKHVfbG9jYXRpb25zLnVfSywgc2V0dGluZ3MuSylcbiAgZ2wudW5pZm9ybTFmKHVfbG9jYXRpb25zLnVfUiwgc2V0dGluZ3MuUilcbiAgZ2wudW5pZm9ybTNmKHVfbG9jYXRpb25zLnVfY29sb3IsIHNldHRpbmdzLmNvbG9yWzBdLCBzZXR0aW5ncy5jb2xvclsxXSwgc2V0dGluZ3MuY29sb3JbMl0pXG4gIGdsLnVuaWZvcm0xaSh1X2xvY2F0aW9ucy51X3Bvc2l0aW9ucywgMClcbiAgZ2wudGV4SW1hZ2UyRChnbC5URVhUVVJFXzJELCAwLCBnbC5SR0JBLCBNQVhfUEFSVElDTEVTX1BFUl9CVUNLRVQsIEJVQ0tFVF9DT1VOVCwgMCwgZ2wuUkdCQSwgZ2wuRkxPQVQsIHBTb3J0ZWQpXG4gIGdsLmRyYXdBcnJheXMoZ2wuVFJJQU5HTEVTLCAwLCBxdWFkU2l6ZSlcbiAgcmFmKHJlbmRlcilcbn0pXG4iLCJleHBvcnQgZnVuY3Rpb24gcmFuZEludCAoIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlciApOiBudW1iZXIge1xuICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKCBtYXggLSBtaW4gKSArIG1pbilcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJhbmROdW0gKCBtaW46IG51bWJlciwgbWF4OiBudW1iZXIgKTogbnVtYmVyIHtcbiAgcmV0dXJuIE1hdGgucmFuZG9tKCkgKiAoIG1heCAtIG1pbiApICsgbWluXG59XG4iXX0=
