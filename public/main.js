(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
var random_1 = require("./utils/random");
var range_1 = require("./utils/range");
var canvas = document.createElement('canvas');
var slider = document.createElement('input');
var gl = canvas.getContext('webgl');
if (gl == null) {
    throw new Error('gl context could not be obtained');
}
var MAX_VEC4_UNIFORM_SIZE = gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS);
var NUM_FIXED_UNIFORMS = 8; // reserve 8 slots for customization and non-sphere data
var SPHERE_COUNT = (MAX_VEC4_UNIFORM_SIZE - NUM_FIXED_UNIFORMS) / 2;
var AREA = [800, 450];
console.log(MAX_VEC4_UNIFORM_SIZE);
var radii = new Float32Array(SPHERE_COUNT);
var positions = new Float32Array(2 * SPHERE_COUNT);
var velocities = new Float32Array(2 * SPHERE_COUNT);
var settings = {
    K: 0.1,
    color: [.2, .4, .8]
};
for (var i = 0; i < SPHERE_COUNT; i++) {
    radii[i] = random_1.randInt(4, 30);
    positions[i * 2] = random_1.randInt(0, AREA[0]);
    positions[i * 2 + 1] = random_1.randInt(0, AREA[1]);
    velocities[i * 2] = random_1.randInt(-4, 4);
    velocities[i * 2 + 1] = random_1.randInt(-4, 4);
}
var vsrc = "\nprecision mediump float;\n\nattribute vec2 a_vertices;\n\nvoid main () {\n  gl_Position = vec4(a_vertices, 1.0, 1.0);\n}\n";
var fsrc = "\nprecision mediump float;\n\nuniform float u_time;\nuniform float u_K;\nuniform vec3 u_color;\nuniform float u_radii [ " + SPHERE_COUNT + " ];\nuniform vec2 u_positions [ " + SPHERE_COUNT + " ];\n\nfloat sdf_sphere ( float r, vec2 c, vec2 p ) {\n  return distance(p, c) - r;\n}\n\nvoid main () {\n  vec2 p = gl_FragCoord.xy;\n  float dist = 0.;\n\n  for ( int i = 0; i < " + SPHERE_COUNT + "; i++ ) {\n    dist += exp(-u_K * sdf_sphere(u_radii[i], u_positions[i], p));\n  }\n  dist = -log(dist) / u_K;\n  float opacity = clamp(.5 - dist, 0.0, 1.0);\n\n  gl_FragColor = vec4(u_color, opacity);\n}\n";
var vertex = gl.createShader(gl.VERTEX_SHADER);
var fragment = gl.createShader(gl.FRAGMENT_SHADER);
var program = gl.createProgram();
var screenQuad = new Float32Array([
    -1, 1, -1, -1, 1, -1,
    -1, 1, 1, -1, 1, 1
]);
var quadSize = screenQuad.length / 2;
if (vertex == null && fragment == null && program == null) {
    throw new Error('gl resources could not be obtained');
}
gl.shaderSource(vertex, vsrc);
gl.compileShader(vertex);
gl.shaderSource(fragment, fsrc);
gl.compileShader(fragment);
gl.attachShader(program, vertex);
gl.attachShader(program, fragment);
gl.linkProgram(program);
gl.useProgram(program);
if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
    console.log(gl.getShaderInfoLog(vertex));
    console.log(gl.getShaderInfoLog(fragment));
    console.log(gl.getProgramInfoLog(program));
}
var verticesBuffer = gl.createBuffer();
var a_locations = {
    a_vertices: gl.getAttribLocation(program, 'a_vertices')
};
var u_locations = {
    u_K: gl.getUniformLocation(program, 'u_K'),
    u_color: gl.getUniformLocation(program, 'u_color'),
    u_time: gl.getUniformLocation(program, 'u_time'),
    u_radii: gl.getUniformLocation(program, 'u_radii'),
    u_positions: gl.getUniformLocation(program, 'u_positions')
};
gl.bindBuffer(gl.ARRAY_BUFFER, verticesBuffer);
gl.enableVertexAttribArray(a_locations.a_vertices);
gl.vertexAttribPointer(a_locations.a_vertices, 2, gl.FLOAT, false, 0, 0);
gl.bufferData(gl.ARRAY_BUFFER, screenQuad, gl.STATIC_DRAW);
slider.type = 'range';
slider.min = '0';
slider.max = '0.1';
slider.step = '0.01';
slider.value = settings.K.toString();
slider.addEventListener('input', function (_) { return settings.K = Number(slider.value); });
canvas.width = AREA[0];
canvas.height = AREA[1];
canvas.style.boxSizing = 'border-box';
canvas.style.border = '2px solid Coral';
document.body.style.margin = '0';
document.body.style.backgroundColor = 'MistyRose';
document.body.appendChild(canvas);
document.body.appendChild(slider);
gl.viewport(0, 0, AREA[0], AREA[1]);
gl.enable(gl.CULL_FACE);
gl.clearColor(0, 0, 0, 0);
gl.useProgram(program);
var start = Date.now();
var raf = window.requestAnimationFrame;
var activeUniformCount = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);
var stats = {
    uniformSize: 0
};
for (var i = 0, au; i < activeUniformCount; i++) {
    au = gl.getActiveUniform(program, i);
    stats.uniformSize += au == null ? 0 : au.size;
}
console.log(stats.uniformSize);
raf(function render() {
    var time = Date.now();
    var buffer = 1.05;
    if (time - start > 1000) {
        for (var i = 0; i < 2 * SPHERE_COUNT; i += 2) {
            positions[i] = range_1.wrap(-AREA[0] * buffer, AREA[0] * buffer, positions[i] + velocities[i]);
            positions[i + 1] = range_1.wrap(-AREA[1] * buffer, AREA[1] * buffer, positions[i + 1] + velocities[i + 1]);
        }
    }
    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
    gl.uniform1f(u_locations.u_time, time);
    gl.uniform1f(u_locations.u_K, settings.K);
    gl.uniform3f(u_locations.u_color, settings.color[0], settings.color[1], settings.color[2]);
    gl.uniform1fv(u_locations.u_radii, radii);
    gl.uniform2fv(u_locations.u_positions, positions);
    gl.drawArrays(gl.TRIANGLES, 0, quadSize);
    raf(render);
});

},{"./utils/random":2,"./utils/range":3}],2:[function(require,module,exports){
"use strict";
function randInt(min, max) {
    return Math.floor(Math.random() * (max - min) + min);
}
exports.randInt = randInt;

},{}],3:[function(require,module,exports){
"use strict";
function wrap(min, max, val) {
    if (val > max)
        return min + (val - max);
    else if (val < min)
        return max + (min - val);
    else
        return val;
}
exports.wrap = wrap;

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL3dhdGNoaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbWFpbi50cyIsInNyYy91dGlscy9yYW5kb20udHMiLCJzcmMvdXRpbHMvcmFuZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FDQUEseUNBQXdDO0FBQ3hDLHVDQUFvQztBQUVwQyxJQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0FBQy9DLElBQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUE7QUFDOUMsSUFBTSxFQUFFLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQTtBQUVyQyxFQUFFLENBQUMsQ0FBRSxFQUFFLElBQUksSUFBSyxDQUFDLENBQUMsQ0FBQztJQUNqQixNQUFNLElBQUksS0FBSyxDQUFDLGtDQUFrQyxDQUFDLENBQUE7QUFDckQsQ0FBQztBQUVELElBQU0scUJBQXFCLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsMEJBQTBCLENBQUMsQ0FBQTtBQUM1RSxJQUFNLGtCQUFrQixHQUFHLENBQUMsQ0FBQSxDQUFDLHdEQUF3RDtBQUNyRixJQUFNLFlBQVksR0FBRyxDQUFFLHFCQUFxQixHQUFHLGtCQUFrQixDQUFFLEdBQUcsQ0FBQyxDQUFBO0FBQ3ZFLElBQU0sSUFBSSxHQUFHLENBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBRSxDQUFBO0FBRXpCLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQTtBQUVsQyxJQUFNLEtBQUssR0FBRyxJQUFJLFlBQVksQ0FBQyxZQUFZLENBQUMsQ0FBQTtBQUM1QyxJQUFNLFNBQVMsR0FBRyxJQUFJLFlBQVksQ0FBQyxDQUFDLEdBQUcsWUFBWSxDQUFDLENBQUE7QUFDcEQsSUFBTSxVQUFVLEdB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Q0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUMsQ0FBQTtJQUNqRCxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFBO0lBQ3hDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQTtBQUNiLENBQUMsQ0FBQyxDQUFBOzs7O0FDNUtGLGlCQUEwQixHQUFXLEVBQUUsR0FBVztJQUNoRCxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBRSxHQUFHLEdBQUcsR0FBRyxDQUFFLEdBQUcsR0FBRyxDQUFDLENBQUE7QUFDeEQsQ0FBQztBQUZELDBCQUVDOzs7O0FDRkQsY0FBdUIsR0FBVyxFQUFFLEdBQVcsRUFBRSxHQUFXO0lBQzFELEVBQUUsQ0FBTSxDQUFFLEdBQUcsR0FBRyxHQUFJLENBQUM7UUFBQyxNQUFNLENBQUMsR0FBRyxHQUFHLENBQUUsR0FBRyxHQUFHLEdBQUcsQ0FBRSxDQUFBO0lBQ2hELElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBRSxHQUFHLEdBQUcsR0FBSSxDQUFDO1FBQUMsTUFBTSxDQUFDLEdBQUcsR0FBRyxDQUFFLEdBQUcsR0FBRyxHQUFHLENBQUUsQ0FBQTtJQUNoRCxJQUFJO1FBQWtCLE1BQU0sQ0FBQyxHQUFHLENBQUE7QUFDbEMsQ0FBQztBQUpELG9CQUlDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImltcG9ydCB7IHJhbmRJbnQgfSBmcm9tICcuL3V0aWxzL3JhbmRvbSdcbmltcG9ydCB7IHdyYXAgfSBmcm9tICcuL3V0aWxzL3JhbmdlJ1xuXG5jb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKVxuY29uc3Qgc2xpZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKVxuY29uc3QgZ2wgPSBjYW52YXMuZ2V0Q29udGV4dCgnd2ViZ2wnKVxuXG5pZiAoIGdsID09IG51bGwgKSB7XG4gIHRocm93IG5ldyBFcnJvcignZ2wgY29udGV4dCBjb3VsZCBub3QgYmUgb2J0YWluZWQnKVxufVxuXG5jb25zdCBNQVhfVkVDNF9VTklGT1JNX1NJWkUgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuTUFYX1ZFUlRFWF9VTklGT1JNX1ZFQ1RPUlMpXG5jb25zdCBOVU1fRklYRURfVU5JRk9STVMgPSA4IC8vIHJlc2VydmUgOCBzbG90cyBmb3IgY3VzdG9taXphdGlvbiBhbmQgbm9uLXNwaGVyZSBkYXRhXG5jb25zdCBTUEhFUkVfQ09VTlQgPSAoIE1BWF9WRUM0X1VOSUZPUk1fU0laRSAtIE5VTV9GSVhFRF9VTklGT1JNUyApIC8gMlxuY29uc3QgQVJFQSA9IFsgODAwLCA0NTAgXVxuXG5jb25zb2xlLmxvZyhNQVhfVkVDNF9VTklGT1JNX1NJWkUpXG5cbmNvbnN0IHJhZGlpID0gbmV3IEZsb2F0MzJBcnJheShTUEhFUkVfQ09VTlQpXG5jb25zdCBwb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkFycmF5KDIgKiBTUEhFUkVfQ09VTlQpXG5jb25zdCB2ZWxvY2l0aWVzID0gbmV3IEZsb2F0MzJBcnJheSgyICogU1BIRVJFX0NPVU5UKVxuY29uc3Qgc2V0dGluZ3MgPSB7XG4gIEs6IDAuMSxcbiAgY29sb3I6IFsgLjIsIC40LCAuOCBdXG59XG5cbmZvciAoIHZhciBpID0gMDsgaSA8IFNQSEVSRV9DT1VOVDsgaSsrICkge1xuICByYWRpaVtpXSA9IHJhbmRJbnQoNCwgMzApXG4gIHBvc2l0aW9uc1tpICogMl0gPSByYW5kSW50KDAsIEFSRUFbMF0pXG4gIHBvc2l0aW9uc1tpICogMiArIDFdID0gcmFuZEludCgwLCBBUkVBWzFdKVxuICB2ZWxvY2l0aWVzW2kgKiAyXSA9IHJhbmRJbnQoLTQsIDQpXG4gIHZlbG9jaXRpZXNbaSAqIDIgKyAxXSA9IHJhbmRJbnQoLTQsIDQpXG59XG5cbmNvbnN0IHZzcmMgPSBcbmBcbnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0O1xuXG5hdHRyaWJ1dGUgdmVjMiBhX3ZlcnRpY2VzO1xuXG52b2lkIG1haW4gKCkge1xuICBnbF9Qb3NpdGlvbiA9IHZlYzQoYV92ZXJ0aWNlcywgMS4wLCAxLjApO1xufVxuYFxuXG5jb25zdCBmc3JjID1cbmBcbnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0O1xuXG51bmlmb3JtIGZsb2F0IHVfdGltZTtcbnVuaWZvcm0gZmxvYXQgdV9LO1xudW5pZm9ybSB2ZWMzIHVfY29sb3I7XG51bmlmb3JtIGZsb2F0IHVfcmFkaWkgWyAkeyBTUEhFUkVfQ09VTlQgfSBdO1xudW5pZm9ybSB2ZWMyIHVfcG9zaXRpb25zIFsgJHsgU1BIRVJFX0NPVU5UIH0gXTtcblxuZmxvYXQgc2RmX3NwaGVyZSAoIGZsb2F0IHIsIHZlYzIgYywgdmVjMiBwICkge1xuICByZXR1cm4gZGlzdGFuY2UocCwgYykgLSByO1xufVxuXG52b2lkIG1haW4gKCkge1xuICB2ZWMyIHAgPSBnbF9GcmFnQ29vcmQueHk7XG4gIGZsb2F0IGRpc3QgPSAwLjtcblxuICBmb3IgKCBpbnQgaSA9IDA7IGkgPCAkeyBTUEhFUkVfQ09VTlQgfTsgaSsrICkge1xuICAgIGRpc3QgKz0gZXhwKC11X0sgKiBzZGZfc3BoZXJlKHVfcmFkaWlbaV0sIHVfcG9zaXRpb25zW2ldLCBwKSk7XG4gIH1cbiAgZGlzdCA9IC1sb2coZGlzdCkgLyB1X0s7XG4gIGZsb2F0IG9wYWNpdHkgPSBjbGFtcCguNSAtIGRpc3QsIDAuMCwgMS4wKTtcblxuICBnbF9GcmFnQ29sb3IgPSB2ZWM0KHVfY29sb3IsIG9wYWNpdHkpO1xufVxuYFxuXG5jb25zdCB2ZXJ0ZXggPSBnbC5jcmVhdGVTaGFkZXIoZ2wuVkVSVEVYX1NIQURFUilcbmNvbnN0IGZyYWdtZW50ID0gZ2wuY3JlYXRlU2hhZGVyKGdsLkZSQUdNRU5UX1NIQURFUilcbmNvbnN0IHByb2dyYW0gPSBnbC5jcmVhdGVQcm9ncmFtKClcbmNvbnN0IHNjcmVlblF1YWQgPSBuZXcgRmxvYXQzMkFycmF5KFtcbiAgLTEsIDEsIC0xLCAtMSwgMSwgLTEsXG4gIC0xLCAxLCAxLCAtMSwgMSwgMVxuXSkgXG5jb25zdCBxdWFkU2l6ZSA9IHNjcmVlblF1YWQubGVuZ3RoIC8gMiBcblxuaWYgKCB2ZXJ0ZXggPT0gbnVsbCAmJiBmcmFnbWVudCA9PSBudWxsICYmIHByb2dyYW0gPT0gbnVsbCApIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdnbCByZXNvdXJjZXMgY291bGQgbm90IGJlIG9idGFpbmVkJylcbn1cblxuZ2wuc2hhZGVyU291cmNlKHZlcnRleCwgdnNyYylcbmdsLmNvbXBpbGVTaGFkZXIodmVydGV4KVxuZ2wuc2hhZGVyU291cmNlKGZyYWdtZW50LCBmc3JjKVxuZ2wuY29tcGlsZVNoYWRlcihmcmFnbWVudClcblxuZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIHZlcnRleClcbmdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCBmcmFnbWVudClcbmdsLmxpbmtQcm9ncmFtKHByb2dyYW0pXG5nbC51c2VQcm9ncmFtKHByb2dyYW0pXG5cbmlmICggIWdsLmdldFByb2dyYW1QYXJhbWV0ZXIocHJvZ3JhbSwgZ2wuTElOS19TVEFUVVMpICkge1xuICBjb25zb2xlLmxvZyhnbC5nZXRTaGFkZXJJbmZvTG9nKHZlcnRleCkpXG4gIGNvbnNvbGUubG9nKGdsLmdldFNoYWRlckluZm9Mb2coZnJhZ21lbnQpKVxuICBjb25zb2xlLmxvZyhnbC5nZXRQcm9ncmFtSW5mb0xvZyhwcm9ncmFtKSlcbn1cblxuY29uc3QgdmVydGljZXNCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKVxuY29uc3QgYV9sb2NhdGlvbnMgPSB7XG4gIGFfdmVydGljZXM6IGdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sICdhX3ZlcnRpY2VzJylcbn1cbmNvbnN0IHVfbG9jYXRpb25zID0ge1xuICB1X0s6IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCAndV9LJykgYXMgV2ViR0xVbmlmb3JtTG9jYXRpb24sXG4gIHVfY29sb3I6IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCAndV9jb2xvcicpIGFzIFdlYkdMVW5pZm9ybUxvY2F0aW9uLFxuICB1X3RpbWU6IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCAndV90aW1lJykgYXMgV2ViR0xVbmlmb3JtTG9jYXRpb24sXG4gIHVfcmFkaWk6IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCAndV9yYWRpaScpIGFzIFdlYkdMVW5pZm9ybUxvY2F0aW9uLFxuICB1X3Bvc2l0aW9uczogZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sICd1X3Bvc2l0aW9ucycpIGFzIFdlYkdMVW5pZm9ybUxvY2F0aW9uXG59XG5cbmdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB2ZXJ0aWNlc0J1ZmZlcilcbmdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KGFfbG9jYXRpb25zLmFfdmVydGljZXMpXG5nbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKGFfbG9jYXRpb25zLmFfdmVydGljZXMsIDIsIGdsLkZMT0FULCBmYWxzZSwgMCwgMClcbmdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBzY3JlZW5RdWFkLCBnbC5TVEFUSUNfRFJBVylcblxuc2xpZGVyLnR5cGUgPSAncmFuZ2UnXG5zbGlkZXIubWluID0gJzAnXG5zbGlkZXIubWF4ID0gJzAuMSdcbnNsaWRlci5zdGVwID0gJzAuMDEnXG5zbGlkZXIudmFsdWUgPSBzZXR0aW5ncy5LLnRvU3RyaW5nKClcbnNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIF8gPT4gc2V0dGluZ3MuSyA9IE51bWJlcihzbGlkZXIudmFsdWUpKVxuXG5jYW52YXMud2lkdGggPSBBUkVBWzBdXG5jYW52YXMuaGVpZ2h0ID0gQVJFQVsxXVxuY2FudmFzLnN0eWxlLmJveFNpemluZyA9ICdib3JkZXItYm94J1xuY2FudmFzLnN0eWxlLmJvcmRlciA9ICcycHggc29saWQgQ29yYWwnXG5kb2N1bWVudC5ib2R5LnN0eWxlLm1hcmdpbiA9ICcwJ1xuZG9jdW1lbnQuYm9keS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnTWlzdHlSb3NlJ1xuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjYW52YXMpXG5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNsaWRlcilcblxuZ2wudmlld3BvcnQoMCwgMCwgQVJFQVswXSwgQVJFQVsxXSlcbmdsLmVuYWJsZShnbC5DVUxMX0ZBQ0UpXG5nbC5jbGVhckNvbG9yKDAsIDAsIDAsIDApXG5nbC51c2VQcm9ncmFtKHByb2dyYW0pXG5cbmNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKVxuY29uc3QgcmFmID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZVxuY29uc3QgYWN0aXZlVW5pZm9ybUNvdW50ID0gZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlcihwcm9ncmFtLCBnbC5BQ1RJVkVfVU5JRk9STVMpXG5jb25zdCBzdGF0cyA9IHtcbiAgdW5pZm9ybVNpemU6IDBcbn1cblxuZm9yICggdmFyIGkgPSAwLCBhdTsgaSA8IGFjdGl2ZVVuaWZvcm1Db3VudDsgaSsrICkge1xuICBhdSA9IGdsLmdldEFjdGl2ZVVuaWZvcm0ocHJvZ3JhbSwgaSlcbiAgc3RhdHMudW5pZm9ybVNpemUgKz0gYXUgPT0gbnVsbCA/IDAgOiBhdS5zaXplXG59XG5cbmNvbnNvbGUubG9nKHN0YXRzLnVuaWZvcm1TaXplKVxuXG5yYWYoZnVuY3Rpb24gcmVuZGVyKCkge1xuICBjb25zdCB0aW1lID0gRGF0ZS5ub3coKVxuICBjb25zdCBidWZmZXIgPSAxLjA1XG5cbiAgaWYgKCB0aW1lIC0gc3RhcnQgPiAxMDAwICkge1xuICAgIGZvciAoIHZhciBpID0gMDsgaSA8IDIgKiBTUEhFUkVfQ09VTlQ7IGkgKz0gMiApIHtcbiAgICAgIHBvc2l0aW9uc1tpXSA9IHdyYXAoLUFSRUFbMF0gKiBidWZmZXIsIEFSRUFbMF0gKiBidWZmZXIsIHBvc2l0aW9uc1tpXSArIHZlbG9jaXRpZXNbaV0pXG4gICAgICBwb3NpdGlvbnNbaSArIDFdID0gd3JhcCgtQVJFQVsxXSAqIGJ1ZmZlciwgQVJFQVsxXSAqIGJ1ZmZlciwgcG9zaXRpb25zW2kgKyAxXSsgdmVsb2NpdGllc1tpICsgMV0pXG4gICAgfVxuICB9XG4gIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQgfCBnbC5ERVBUSF9CVUZGRVJfQklUKVxuICBnbC51bmlmb3JtMWYodV9sb2NhdGlvbnMudV90aW1lLCB0aW1lKVxuICBnbC51bmlmb3JtMWYodV9sb2NhdGlvbnMudV9LLCBzZXR0aW5ncy5LKVxuICBnbC51bmlmb3JtM2YodV9sb2NhdGlvbnMudV9jb2xvciwgc2V0dGluZ3MuY29sb3JbMF0sIHNldHRpbmdzLmNvbG9yWzFdLCBzZXR0aW5ncy5jb2xvclsyXSlcbiAgZ2wudW5pZm9ybTFmdih1X2xvY2F0aW9ucy51X3JhZGlpLCByYWRpaSlcbiAgZ2wudW5pZm9ybTJmdih1X2xvY2F0aW9ucy51X3Bvc2l0aW9ucywgcG9zaXRpb25zKVxuICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFUywgMCwgcXVhZFNpemUpXG4gIHJhZihyZW5kZXIpXG59KVxuIiwiZXhwb3J0IGZ1bmN0aW9uIHJhbmRJbnQgKCBtaW46IG51bWJlciwgbWF4OiBudW1iZXIgKTogbnVtYmVyIHtcbiAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICggbWF4IC0gbWluICkgKyBtaW4pXG59XG4iLCJleHBvcnQgZnVuY3Rpb24gd3JhcCAoIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlciwgdmFsOiBudW1iZXIgKTogbnVtYmVyIHtcbiAgaWYgICAgICAoIHZhbCA+IG1heCApIHJldHVybiBtaW4gKyAoIHZhbCAtIG1heCApXG4gIGVsc2UgaWYgKCB2YWwgPCBtaW4gKSByZXR1cm4gbWF4ICsgKCBtaW4gLSB2YWwgKVxuICBlbHNlICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbFxufVxuIl19
